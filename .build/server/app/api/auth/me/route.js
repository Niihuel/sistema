/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/me/route";
exports.ids = ["app/api/auth/me/route"];
exports.modules = {

/***/ "(rsc)/./app/api/auth/me/route.ts":
/*!**********************************!*\
  !*** ./app/api/auth/me/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _lib_middleware__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/middleware */ \"(rsc)/./lib/middleware.ts\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n\n\nasync function GET(req) {\n    const startTime = Date.now();\n    const requestId = Math.random().toString(36).substring(7);\n    const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_3__.headers)();\n    const userAgent = headersList.get('user-agent') || 'unknown';\n    const ipAddress = headersList.get('x-forwarded-for') || headersList.get('x-real-ip') || 'unknown';\n    console.log(`[/api/auth/me] ${requestId}: Starting request from ${ipAddress}`);\n    try {\n        // Get auth context with comprehensive error handling\n        let ctx;\n        try {\n            console.log(`[/api/auth/me] ${requestId}: Checking auth context`);\n            ctx = (0,_lib_middleware__WEBPACK_IMPORTED_MODULE_2__.requireAuth)(req);\n            console.log(`[/api/auth/me] ${requestId}: Auth context obtained for user ${ctx.userId}`);\n        } catch (authError) {\n            console.log(`[/api/auth/me] ${requestId}: Auth error:`, authError);\n            if (authError instanceof _lib_middleware__WEBPACK_IMPORTED_MODULE_2__.AuthError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: authError.message,\n                    code: authError.code,\n                    timestamp: new Date().toISOString(),\n                    requestId\n                }, {\n                    status: authError.status\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication required\",\n                code: \"AUTH_REQUIRED\",\n                timestamp: new Date().toISOString(),\n                requestId\n            }, {\n                status: 401\n            });\n        }\n        // Validate context structure\n        if (!ctx || !ctx.userId || typeof ctx.userId !== 'number') {\n            console.log(`[/api/auth/me] ${requestId}: Invalid context structure:`, ctx);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid authentication context\",\n                code: \"INVALID_CONTEXT\",\n                timestamp: new Date().toISOString(),\n                requestId\n            }, {\n                status: 401\n            });\n        }\n        console.log(`[/api/auth/me] ${requestId}: Starting database query for user ${ctx.userId}`);\n        // Get basic user data (production-ready simplified version)\n        const user = await (0,_lib_prisma__WEBPACK_IMPORTED_MODULE_1__.withDatabase)(async (prisma)=>{\n            console.log(`[/api/auth/me] ${requestId}: Inside withDatabase callback`);\n            const userData = await prisma.user.findUnique({\n                where: {\n                    id: ctx.userId\n                },\n                select: {\n                    id: true,\n                    username: true,\n                    role: true,\n                    createdAt: true,\n                    updatedAt: true\n                }\n            });\n            console.log(`[/api/auth/me] ${requestId}: Database query completed, found user:`, !!userData);\n            return userData;\n        });\n        console.log(`[/api/auth/me] ${requestId}: Database query finished`);\n        // Check if user exists\n        if (!user) {\n            console.log(`[/api/auth/me] ${requestId}: User not found for ID ${ctx.userId}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User not found\",\n                code: \"USER_NOT_FOUND\",\n                timestamp: new Date().toISOString(),\n                requestId\n            }, {\n                status: 404\n            });\n        }\n        console.log(`[/api/auth/me] ${requestId}: Building user profile`);\n        // Build production-ready user profile with Discord system support\n        const userProfile = {\n            id: user.id,\n            username: user.username,\n            role: user.role,\n            isActive: true,\n            isEmailVerified: true,\n            twoFactorEnabled: false,\n            // Legacy roles for backward compatibility\n            roles: [\n                {\n                    id: 1,\n                    name: user.role,\n                    displayName: getRoleDisplayName(user.role),\n                    level: getRoleLevel(user.role),\n                    isActive: true,\n                    isPrimary: true,\n                    isTemporary: false,\n                    assignedAt: user.createdAt,\n                    color: getRoleColor(user.role),\n                    icon: getRoleIcon(user.role)\n                }\n            ],\n            // Discord-style roles (future expansion)\n            discordRoles: [\n                {\n                    id: `discord-${user.role}`,\n                    name: user.role,\n                    displayName: getRoleDisplayName(user.role),\n                    level: getRoleLevel(user.role),\n                    isActive: true,\n                    isPrimary: true,\n                    isTemporary: false,\n                    assignedAt: user.createdAt,\n                    color: getRoleColor(user.role),\n                    icon: getRoleIcon(user.role)\n                }\n            ],\n            // Simplified permissions based on role\n            permissions: getPermissionsForRole(user.role),\n            deniedPermissions: [],\n            settings: {\n                timezone: 'America/Mexico_City',\n                locale: 'es-MX',\n                theme: 'dark'\n            },\n            security: {\n                sessionCount: 1,\n                requiresPasswordChange: false,\n                mfaRequired: false\n            },\n            metadata: {\n                createdAt: user.createdAt,\n                updatedAt: user.updatedAt\n            }\n        };\n        console.log(`[/api/auth/me] ${requestId}: Sending response, total time: ${Date.now() - startTime}ms`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(userProfile, {\n            status: 200,\n            headers: {\n                'Cache-Control': 'private, no-cache, no-store, must-revalidate',\n                'X-Request-ID': requestId,\n                'X-Response-Time': `${Date.now() - startTime}ms`\n            }\n        });\n    } catch (error) {\n        console.error(`[/api/auth/me] ${requestId}: Error after ${Date.now() - startTime}ms:`, error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            code: \"INTERNAL_ERROR\",\n            timestamp: new Date().toISOString(),\n            requestId\n        }, {\n            status: 500\n        });\n    }\n}\n// Helper functions for role management\nfunction getRoleDisplayName(role) {\n    const roleNames = {\n        'SUPER_ADMIN': 'Super Administrador',\n        'ADMIN': 'Administrador',\n        'MANAGER': 'Gerente',\n        'TECHNICIAN': 'TÃ©cnico',\n        'SUPPORT': 'Soporte',\n        'EMPLOYEE': 'Empleado',\n        'USER': 'Usuario',\n        'GUEST': 'Invitado'\n    };\n    return roleNames[role] || role;\n}\nfunction getRoleLevel(role) {\n    const roleLevels = {\n        'SUPER_ADMIN': 100,\n        'ADMIN': 90,\n        'MANAGER': 70,\n        'TECHNICIAN': 50,\n        'SUPPORT': 40,\n        'EMPLOYEE': 30,\n        'USER': 20,\n        'GUEST': 10\n    };\n    return roleLevels[role] || 0;\n}\nfunction getRoleColor(role) {\n    const roleColors = {\n        'SUPER_ADMIN': '#E74C3C',\n        'ADMIN': '#E67E22',\n        'MANAGER': '#3498DB',\n        'TECHNICIAN': '#9B59B6',\n        'SUPPORT': '#1ABC9C',\n        'EMPLOYEE': '#2ECC71',\n        'USER': '#95A5A6',\n        'GUEST': '#BDC3C7'\n    };\n    return roleColors[role] || '#95A5A6';\n}\nfunction getRoleIcon(role) {\n    const roleIcons = {\n        'SUPER_ADMIN': 'ðŸ‘‘',\n        'ADMIN': 'ðŸ›¡ï¸',\n        'MANAGER': 'ðŸ‘”',\n        'TECHNICIAN': 'ðŸ”§',\n        'SUPPORT': 'ðŸŽ§',\n        'EMPLOYEE': 'ðŸ’¼',\n        'USER': 'ðŸ‘¤',\n        'GUEST': 'ðŸ‘ï¸'\n    };\n    return roleIcons[role] || 'ðŸ‘¤';\n}\nfunction getPermissionsForRole(role) {\n    const basePermissions = [\n        {\n            resource: 'dashboard',\n            actions: [\n                'view'\n            ],\n            scope: 'ALL',\n            riskLevel: 'LOW',\n            requiresMFA: false\n        }\n    ];\n    if (role === 'ADMIN' || role === 'SUPER_ADMIN') {\n        return [\n            ...basePermissions,\n            {\n                resource: 'users',\n                actions: [\n                    'view',\n                    'create',\n                    'edit',\n                    'delete'\n                ],\n                scope: 'ALL',\n                riskLevel: 'HIGH',\n                requiresMFA: false\n            },\n            {\n                resource: 'employees',\n                actions: [\n                    'view',\n                    'create',\n                    'edit',\n                    'delete'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'equipment',\n                actions: [\n                    'view',\n                    'create',\n                    'edit',\n                    'delete'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'inventory',\n                actions: [\n                    'view',\n                    'create',\n                    'edit',\n                    'delete'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'tickets',\n                actions: [\n                    'view_all',\n                    'create',\n                    'edit_all',\n                    'assign',\n                    'close'\n                ],\n                scope: 'ALL',\n                riskLevel: 'LOW',\n                requiresMFA: false\n            },\n            {\n                resource: 'printers',\n                actions: [\n                    'view',\n                    'create',\n                    'edit',\n                    'delete'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'purchases',\n                actions: [\n                    'view',\n                    'create',\n                    'approve',\n                    'process'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'backups',\n                actions: [\n                    'view',\n                    'create'\n                ],\n                scope: 'ALL',\n                riskLevel: 'HIGH',\n                requiresMFA: false\n            }\n        ];\n    }\n    if (role === 'TECHNICIAN') {\n        return [\n            ...basePermissions,\n            {\n                resource: 'equipment',\n                actions: [\n                    'view',\n                    'edit'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            },\n            {\n                resource: 'tickets',\n                actions: [\n                    'view_all',\n                    'edit_all',\n                    'assign',\n                    'close'\n                ],\n                scope: 'ALL',\n                riskLevel: 'LOW',\n                requiresMFA: false\n            },\n            {\n                resource: 'inventory',\n                actions: [\n                    'view',\n                    'edit',\n                    'assign'\n                ],\n                scope: 'ALL',\n                riskLevel: 'MEDIUM',\n                requiresMFA: false\n            }\n        ];\n    }\n    // Default permissions for USER/EMPLOYEE roles\n    return [\n        ...basePermissions,\n        {\n            resource: 'tickets',\n            actions: [\n                'view_own',\n                'create',\n                'edit_own'\n            ],\n            scope: 'OWN',\n            riskLevel: 'LOW',\n            requiresMFA: false\n        },\n        {\n            resource: 'equipment',\n            actions: [\n                'view'\n            ],\n            scope: 'ALL',\n            riskLevel: 'LOW',\n            requiresMFA: false\n        }\n    ];\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0VKLFVBQVU7Z0JBQ1ZDLFNBQVM7b0JBQUM7b0JBQVk7b0JBQVk7b0JBQVU7aUJBQVE7Z0JBQ3BEQyxPQUFPO2dCQUNQQyxXQUFXO2dCQUNYQyxhQUFhO1lBQ2Y7WUFDQTtnQkFDRUosVUFBVTtnQkFDVkMsU0FBUztvQkFBQztvQkFBUTtvQkFBUTtpQkFBUztnQkFDbkNDLE9BQU87Z0JBQ1BDLFdBQVc7Z0JBQ1hDLGFBQWE7WUFDZjtTQUNEO0lBQ0g7SUFFQSw4Q0FBOEM7SUFDOUMsT0FBTztXQUNGTDtRQUNIO1lBQ0VDLFVBQVU7WUFDVkMsU0FBUztnQkFBQztnQkFBWTtnQkFBVTthQUFXO1lBQzNDQyxPQUFPO1lBQ1BDLFdBQVc7WUFDWEMsYUFBYTtRQUNmO1FBQ0E7WUFDRUosVUFBVTtZQUNWQyxTQUFTO2dCQUFDO2FBQU87WUFDakJDLE9BQU87WUFDUEMsV0FBVztZQUNYQyxhQUFhO1FBQ2Y7S0FDRDtBQUNIIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEF1eFNpc3RlbWFzXFxEb2N1bWVudHNcXHNpc3RlbWFzXFxzaXN0XFxzaXN0ZW1hXFxhcHBcXGFwaVxcYXV0aFxcbWVcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIlxuaW1wb3J0IHsgd2l0aERhdGFiYXNlIH0gZnJvbSBcIkAvbGliL3ByaXNtYVwiXG5pbXBvcnQgeyByZXF1aXJlQXV0aCwgQXV0aEVycm9yIH0gZnJvbSBcIkAvbGliL21pZGRsZXdhcmVcIlxuaW1wb3J0IHsgaGVhZGVycyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIlxuXG5pbnRlcmZhY2UgUGVybWlzc2lvblNjb3BlIHtcbiAgcmVzb3VyY2U6IHN0cmluZ1xuICBhY3Rpb25zOiBzdHJpbmdbXVxuICBzY29wZTogc3RyaW5nXG4gIGNvbmRpdGlvbnM/OiBhbnlcbiAgcmlza0xldmVsOiBzdHJpbmdcbiAgcmVxdWlyZXNNRkE6IGJvb2xlYW5cbn1cblxuaW50ZXJmYWNlIFVzZXJQcm9maWxlIHtcbiAgaWQ6IG51bWJlclxuICB1c2VybmFtZTogc3RyaW5nXG4gIGVtYWlsPzogc3RyaW5nXG4gIGZpcnN0TmFtZT86IHN0cmluZ1xuICBsYXN0TmFtZT86IHN0cmluZ1xuICByb2xlOiBzdHJpbmdcbiAgaXNBY3RpdmU6IGJvb2xlYW5cbiAgaXNFbWFpbFZlcmlmaWVkOiBib29sZWFuXG4gIHR3b0ZhY3RvckVuYWJsZWQ6IGJvb2xlYW5cbiAgbGFzdExvZ2luQXQ/OiBEYXRlXG4gIHBhc3N3b3JkRXhwaXJlc0F0PzogRGF0ZVxuICAvLyBTaXN0ZW1hIERpc2NvcmQgbWVqb3JhZG9cbiAgZGlzY29yZFJvbGVzPzogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmdcbiAgICBuYW1lOiBzdHJpbmdcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgICBjb2xvcj86IHN0cmluZ1xuICAgIGljb24/OiBzdHJpbmdcbiAgICBsZXZlbDogbnVtYmVyXG4gICAgaXNBY3RpdmU6IGJvb2xlYW5cbiAgICBpc1ByaW1hcnk6IGJvb2xlYW5cbiAgICBpc1RlbXBvcmFyeTogYm9vbGVhblxuICAgIGV4cGlyZXNBdD86IERhdGVcbiAgICBhc3NpZ25lZEF0OiBEYXRlXG4gICAgY29uZGl0aW9ucz86IGFueVxuICB9PlxuICByb2xlczogQXJyYXk8e1xuICAgIGlkOiBudW1iZXJcbiAgICBuYW1lOiBzdHJpbmdcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgICBjb2xvcj86IHN0cmluZ1xuICAgIGljb24/OiBzdHJpbmdcbiAgICBsZXZlbDogbnVtYmVyXG4gICAgaXNBY3RpdmU6IGJvb2xlYW5cbiAgICBpc1ByaW1hcnk6IGJvb2xlYW5cbiAgICBpc1RlbXBvcmFyeTogYm9vbGVhblxuICAgIGV4cGlyZXNBdD86IERhdGVcbiAgICBhc3NpZ25lZEF0OiBEYXRlXG4gICAgY29uZGl0aW9ucz86IGFueVxuICB9PlxuICBwZXJtaXNzaW9uczogUGVybWlzc2lvblNjb3BlW11cbiAgZGVuaWVkUGVybWlzc2lvbnM6IHN0cmluZ1tdXG4gIHNldHRpbmdzOiB7XG4gICAgdGltZXpvbmU/OiBzdHJpbmdcbiAgICBsb2NhbGU/OiBzdHJpbmdcbiAgICB0aGVtZT86IHN0cmluZ1xuICAgIG5vdGlmaWNhdGlvbnM/OiBhbnlcbiAgfVxuICBzZWN1cml0eToge1xuICAgIHNlc3Npb25Db3VudDogbnVtYmVyXG4gICAgbGFzdFNlY3VyaXR5VXBkYXRlPzogRGF0ZVxuICAgIHJlcXVpcmVzUGFzc3dvcmRDaGFuZ2U6IGJvb2xlYW5cbiAgICBtZmFSZXF1aXJlZDogYm9vbGVhblxuICB9XG4gIG1ldGFkYXRhOiB7XG4gICAgY3JlYXRlZEF0OiBEYXRlXG4gICAgdXBkYXRlZEF0OiBEYXRlXG4gICAgbGFzdEFjdGl2aXR5PzogRGF0ZVxuICAgIGVtcGxveWVlSWQ/OiBudW1iZXJcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKVxuICBjb25zdCByZXF1ZXN0SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNylcbiAgY29uc3QgaGVhZGVyc0xpc3QgPSBhd2FpdCBoZWFkZXJzKClcbiAgY29uc3QgdXNlckFnZW50ID0gaGVhZGVyc0xpc3QuZ2V0KCd1c2VyLWFnZW50JykgfHwgJ3Vua25vd24nXG4gIGNvbnN0IGlwQWRkcmVzcyA9IGhlYWRlcnNMaXN0LmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgaGVhZGVyc0xpc3QuZ2V0KCd4LXJlYWwtaXAnKSB8fCAndW5rbm93bidcblxuICBjb25zb2xlLmxvZyhgWy9hcGkvYXV0aC9tZV0gJHtyZXF1ZXN0SWR9OiBTdGFydGluZyByZXF1ZXN0IGZyb20gJHtpcEFkZHJlc3N9YClcblxuICB0cnkge1xuICAgIC8vIEdldCBhdXRoIGNvbnRleHQgd2l0aCBjb21wcmVoZW5zaXZlIGVycm9yIGhhbmRsaW5nXG4gICAgbGV0IGN0eDtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogQ2hlY2tpbmcgYXV0aCBjb250ZXh0YClcbiAgICAgIGN0eCA9IHJlcXVpcmVBdXRoKHJlcSlcbiAgICAgIGNvbnNvbGUubG9nKGBbL2FwaS9hdXRoL21lXSAke3JlcXVlc3RJZH06IEF1dGggY29udGV4dCBvYnRhaW5lZCBmb3IgdXNlciAke2N0eC51c2VySWR9YClcbiAgICB9IGNhdGNoIChhdXRoRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbL2FwaS9hdXRoL21lXSAke3JlcXVlc3RJZH06IEF1dGggZXJyb3I6YCwgYXV0aEVycm9yKVxuICAgICAgaWYgKGF1dGhFcnJvciBpbnN0YW5jZW9mIEF1dGhFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6IGF1dGhFcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgY29kZTogYXV0aEVycm9yLmNvZGUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlcXVlc3RJZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IGF1dGhFcnJvci5zdGF0dXMgfVxuICAgICAgICApXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXCIsXG4gICAgICAgICAgY29kZTogXCJBVVRIX1JFUVVJUkVEXCIsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgcmVxdWVzdElkXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGNvbnRleHQgc3RydWN0dXJlXG4gICAgaWYgKCFjdHggfHwgIWN0eC51c2VySWQgfHwgdHlwZW9mIGN0eC51c2VySWQgIT09ICdudW1iZXInKSB7XG4gICAgICBjb25zb2xlLmxvZyhgWy9hcGkvYXV0aC9tZV0gJHtyZXF1ZXN0SWR9OiBJbnZhbGlkIGNvbnRleHQgc3RydWN0dXJlOmAsIGN0eClcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBcIkludmFsaWQgYXV0aGVudGljYXRpb24gY29udGV4dFwiLFxuICAgICAgICAgIGNvZGU6IFwiSU5WQUxJRF9DT05URVhUXCIsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgcmVxdWVzdElkXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBbL2FwaS9hdXRoL21lXSAke3JlcXVlc3RJZH06IFN0YXJ0aW5nIGRhdGFiYXNlIHF1ZXJ5IGZvciB1c2VyICR7Y3R4LnVzZXJJZH1gKVxuICAgIFxuICAgIC8vIEdldCBiYXNpYyB1c2VyIGRhdGEgKHByb2R1Y3Rpb24tcmVhZHkgc2ltcGxpZmllZCB2ZXJzaW9uKVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB3aXRoRGF0YWJhc2UoYXN5bmMgKHByaXNtYSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogSW5zaWRlIHdpdGhEYXRhYmFzZSBjYWxsYmFja2ApXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGlkOiBjdHgudXNlcklkXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgIHJvbGU6IHRydWUsXG4gICAgICAgICAgY3JlYXRlZEF0OiB0cnVlLFxuICAgICAgICAgIHVwZGF0ZWRBdDogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgY29uc29sZS5sb2coYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogRGF0YWJhc2UgcXVlcnkgY29tcGxldGVkLCBmb3VuZCB1c2VyOmAsICEhdXNlckRhdGEpXG4gICAgICByZXR1cm4gdXNlckRhdGFcbiAgICB9KVxuXG4gICAgY29uc29sZS5sb2coYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogRGF0YWJhc2UgcXVlcnkgZmluaXNoZWRgKVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBleGlzdHNcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBbL2FwaS9hdXRoL21lXSAke3JlcXVlc3RJZH06IFVzZXIgbm90IGZvdW5kIGZvciBJRCAke2N0eC51c2VySWR9YClcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAge1xuICAgICAgICAgIGVycm9yOiBcIlVzZXIgbm90IGZvdW5kXCIsXG4gICAgICAgICAgY29kZTogXCJVU0VSX05PVF9GT1VORFwiLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHJlcXVlc3RJZFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhgWy9hcGkvYXV0aC9tZV0gJHtyZXF1ZXN0SWR9OiBCdWlsZGluZyB1c2VyIHByb2ZpbGVgKVxuXG4gICAgLy8gQnVpbGQgcHJvZHVjdGlvbi1yZWFkeSB1c2VyIHByb2ZpbGUgd2l0aCBEaXNjb3JkIHN5c3RlbSBzdXBwb3J0XG4gICAgY29uc3QgdXNlclByb2ZpbGU6IFVzZXJQcm9maWxlID0ge1xuICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgaXNFbWFpbFZlcmlmaWVkOiB0cnVlLFxuICAgICAgdHdvRmFjdG9yRW5hYmxlZDogZmFsc2UsXG4gICAgICAvLyBMZWdhY3kgcm9sZXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAgIHJvbGVzOiBbe1xuICAgICAgICBpZDogMSxcbiAgICAgICAgbmFtZTogdXNlci5yb2xlLFxuICAgICAgICBkaXNwbGF5TmFtZTogZ2V0Um9sZURpc3BsYXlOYW1lKHVzZXIucm9sZSksXG4gICAgICAgIGxldmVsOiBnZXRSb2xlTGV2ZWwodXNlci5yb2xlKSxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIGlzUHJpbWFyeTogdHJ1ZSxcbiAgICAgICAgaXNUZW1wb3Jhcnk6IGZhbHNlLFxuICAgICAgICBhc3NpZ25lZEF0OiB1c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgY29sb3I6IGdldFJvbGVDb2xvcih1c2VyLnJvbGUpLFxuICAgICAgICBpY29uOiBnZXRSb2xlSWNvbih1c2VyLnJvbGUpXG4gICAgICB9XSxcbiAgICAgIC8vIERpc2NvcmQtc3R5bGUgcm9sZXMgKGZ1dHVyZSBleHBhbnNpb24pXG4gICAgICBkaXNjb3JkUm9sZXM6IFt7XG4gICAgICAgIGlkOiBgZGlzY29yZC0ke3VzZXIucm9sZX1gLFxuICAgICAgICBuYW1lOiB1c2VyLnJvbGUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBnZXRSb2xlRGlzcGxheU5hbWUodXNlci5yb2xlKSxcbiAgICAgICAgbGV2ZWw6IGdldFJvbGVMZXZlbCh1c2VyLnJvbGUpLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgaXNQcmltYXJ5OiB0cnVlLFxuICAgICAgICBpc1RlbXBvcmFyeTogZmFsc2UsXG4gICAgICAgIGFzc2lnbmVkQXQ6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgICBjb2xvcjogZ2V0Um9sZUNvbG9yKHVzZXIucm9sZSksXG4gICAgICAgIGljb246IGdldFJvbGVJY29uKHVzZXIucm9sZSlcbiAgICAgIH1dLFxuICAgICAgLy8gU2ltcGxpZmllZCBwZXJtaXNzaW9ucyBiYXNlZCBvbiByb2xlXG4gICAgICBwZXJtaXNzaW9uczogZ2V0UGVybWlzc2lvbnNGb3JSb2xlKHVzZXIucm9sZSksXG4gICAgICBkZW5pZWRQZXJtaXNzaW9uczogW10sXG4gICAgICBzZXR0aW5nczoge1xuICAgICAgICB0aW1lem9uZTogJ0FtZXJpY2EvTWV4aWNvX0NpdHknLFxuICAgICAgICBsb2NhbGU6ICdlcy1NWCcsXG4gICAgICAgIHRoZW1lOiAnZGFyaydcbiAgICAgIH0sXG4gICAgICBzZWN1cml0eToge1xuICAgICAgICBzZXNzaW9uQ291bnQ6IDEsXG4gICAgICAgIHJlcXVpcmVzUGFzc3dvcmRDaGFuZ2U6IGZhbHNlLFxuICAgICAgICBtZmFSZXF1aXJlZDogZmFsc2VcbiAgICAgIH0sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBjcmVhdGVkQXQ6IHVzZXIuY3JlYXRlZEF0LFxuICAgICAgICB1cGRhdGVkQXQ6IHVzZXIudXBkYXRlZEF0XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogU2VuZGluZyByZXNwb25zZSwgdG90YWwgdGltZTogJHtEYXRlLm5vdygpIC0gc3RhcnRUaW1lfW1zYClcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih1c2VyUHJvZmlsZSwge1xuICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDYWNoZS1Db250cm9sJzogJ3ByaXZhdGUsIG5vLWNhY2hlLCBuby1zdG9yZSwgbXVzdC1yZXZhbGlkYXRlJyxcbiAgICAgICAgJ1gtUmVxdWVzdC1JRCc6IHJlcXVlc3RJZCxcbiAgICAgICAgJ1gtUmVzcG9uc2UtVGltZSc6IGAke0RhdGUubm93KCkgLSBzdGFydFRpbWV9bXNgXG4gICAgICB9XG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYFsvYXBpL2F1dGgvbWVdICR7cmVxdWVzdElkfTogRXJyb3IgYWZ0ZXIgJHtEYXRlLm5vdygpIC0gc3RhcnRUaW1lfW1zOmAsIGVycm9yKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAge1xuICAgICAgICBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIixcbiAgICAgICAgY29kZTogXCJJTlRFUk5BTF9FUlJPUlwiLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcmVxdWVzdElkXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbnMgZm9yIHJvbGUgbWFuYWdlbWVudFxuZnVuY3Rpb24gZ2V0Um9sZURpc3BsYXlOYW1lKHJvbGU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHJvbGVOYW1lczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgICAnU1VQRVJfQURNSU4nOiAnU3VwZXIgQWRtaW5pc3RyYWRvcicsXG4gICAgJ0FETUlOJzogJ0FkbWluaXN0cmFkb3InLFxuICAgICdNQU5BR0VSJzogJ0dlcmVudGUnLFxuICAgICdURUNITklDSUFOJzogJ1TDqWNuaWNvJyxcbiAgICAnU1VQUE9SVCc6ICdTb3BvcnRlJyxcbiAgICAnRU1QTE9ZRUUnOiAnRW1wbGVhZG8nLFxuICAgICdVU0VSJzogJ1VzdWFyaW8nLFxuICAgICdHVUVTVCc6ICdJbnZpdGFkbydcbiAgfVxuICByZXR1cm4gcm9sZU5hbWVzW3JvbGVdIHx8IHJvbGVcbn1cblxuZnVuY3Rpb24gZ2V0Um9sZUxldmVsKHJvbGU6IHN0cmluZyk6IG51bWJlciB7XG4gIGNvbnN0IHJvbGVMZXZlbHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJ1NVUEVSX0FETUlOJzogMTAwLFxuICAgICdBRE1JTic6IDkwLFxuICAgICdNQU5BR0VSJzogNzAsXG4gICAgJ1RFQ0hOSUNJQU4nOiA1MCxcbiAgICAnU1VQUE9SVCc6IDQwLFxuICAgICdFTVBMT1lFRSc6IDMwLFxuICAgICdVU0VSJzogMjAsXG4gICAgJ0dVRVNUJzogMTBcbiAgfVxuICByZXR1cm4gcm9sZUxldmVsc1tyb2xlXSB8fCAwXG59XG5cbmZ1bmN0aW9uIGdldFJvbGVDb2xvcihyb2xlOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCByb2xlQ29sb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICdTVVBFUl9BRE1JTic6ICcjRTc0QzNDJyxcbiAgICAnQURNSU4nOiAnI0U2N0UyMicsXG4gICAgJ01BTkFHRVInOiAnIzM0OThEQicsXG4gICAgJ1RFQ0hOSUNJQU4nOiAnIzlCNTlCNicsXG4gICAgJ1NVUFBPUlQnOiAnIzFBQkM5QycsXG4gICAgJ0VNUExPWUVFJzogJyMyRUNDNzEnLFxuICAgICdVU0VSJzogJyM5NUE1QTYnLFxuICAgICdHVUVTVCc6ICcjQkRDM0M3J1xuICB9XG4gIHJldHVybiByb2xlQ29sb3JzW3JvbGVdIHx8ICcjOTVBNUE2J1xufVxuXG5mdW5jdGlvbiBnZXRSb2xlSWNvbihyb2xlOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCByb2xlSWNvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ1NVUEVSX0FETUlOJzogJ/CfkZEnLFxuICAgICdBRE1JTic6ICfwn5uh77iPJyxcbiAgICAnTUFOQUdFUic6ICfwn5GUJyxcbiAgICAnVEVDSE5JQ0lBTic6ICfwn5SnJyxcbiAgICAnU1VQUE9SVCc6ICfwn46nJyxcbiAgICAnRU1QTE9ZRUUnOiAn8J+SvCcsXG4gICAgJ1VTRVInOiAn8J+RpCcsXG4gICAgJ0dVRVNUJzogJ/CfkYHvuI8nXG4gIH1cbiAgcmV0dXJuIHJvbGVJY29uc1tyb2xlXSB8fCAn8J+RpCdcbn1cblxuZnVuY3Rpb24gZ2V0UGVybWlzc2lvbnNGb3JSb2xlKHJvbGU6IHN0cmluZyk6IFBlcm1pc3Npb25TY29wZVtdIHtcbiAgY29uc3QgYmFzZVBlcm1pc3Npb25zOiBQZXJtaXNzaW9uU2NvcGVbXSA9IFtcbiAgICB7XG4gICAgICByZXNvdXJjZTogJ2Rhc2hib2FyZCcsXG4gICAgICBhY3Rpb25zOiBbJ3ZpZXcnXSxcbiAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgIHJpc2tMZXZlbDogJ0xPVycsXG4gICAgICByZXF1aXJlc01GQTogZmFsc2VcbiAgICB9XG4gIF1cblxuICBpZiAocm9sZSA9PT0gJ0FETUlOJyB8fCByb2xlID09PSAnU1VQRVJfQURNSU4nKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIC4uLmJhc2VQZXJtaXNzaW9ucyxcbiAgICAgIHtcbiAgICAgICAgcmVzb3VyY2U6ICd1c2VycycsXG4gICAgICAgIGFjdGlvbnM6IFsndmlldycsICdjcmVhdGUnLCAnZWRpdCcsICdkZWxldGUnXSxcbiAgICAgICAgc2NvcGU6ICdBTEwnLFxuICAgICAgICByaXNrTGV2ZWw6ICdISUdIJyxcbiAgICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ2VtcGxveWVlcycsXG4gICAgICAgIGFjdGlvbnM6IFsndmlldycsICdjcmVhdGUnLCAnZWRpdCcsICdkZWxldGUnXSxcbiAgICAgICAgc2NvcGU6ICdBTEwnLFxuICAgICAgICByaXNrTGV2ZWw6ICdNRURJVU0nLFxuICAgICAgICByZXF1aXJlc01GQTogZmFsc2VcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHJlc291cmNlOiAnZXF1aXBtZW50JyxcbiAgICAgICAgYWN0aW9uczogWyd2aWV3JywgJ2NyZWF0ZScsICdlZGl0JywgJ2RlbGV0ZSddLFxuICAgICAgICBzY29wZTogJ0FMTCcsXG4gICAgICAgIHJpc2tMZXZlbDogJ01FRElVTScsXG4gICAgICAgIHJlcXVpcmVzTUZBOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcmVzb3VyY2U6ICdpbnZlbnRvcnknLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXcnLCAnY3JlYXRlJywgJ2VkaXQnLCAnZGVsZXRlJ10sXG4gICAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgICAgcmlza0xldmVsOiAnTUVESVVNJyxcbiAgICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ3RpY2tldHMnLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXdfYWxsJywgJ2NyZWF0ZScsICdlZGl0X2FsbCcsICdhc3NpZ24nLCAnY2xvc2UnXSxcbiAgICAgICAgc2NvcGU6ICdBTEwnLFxuICAgICAgICByaXNrTGV2ZWw6ICdMT1cnLFxuICAgICAgICByZXF1aXJlc01GQTogZmFsc2VcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHJlc291cmNlOiAncHJpbnRlcnMnLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXcnLCAnY3JlYXRlJywgJ2VkaXQnLCAnZGVsZXRlJ10sXG4gICAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgICAgcmlza0xldmVsOiAnTUVESVVNJyxcbiAgICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ3B1cmNoYXNlcycsXG4gICAgICAgIGFjdGlvbnM6IFsndmlldycsICdjcmVhdGUnLCAnYXBwcm92ZScsICdwcm9jZXNzJ10sXG4gICAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgICAgcmlza0xldmVsOiAnTUVESVVNJyxcbiAgICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ2JhY2t1cHMnLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXcnLCAnY3JlYXRlJ10sXG4gICAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgICAgcmlza0xldmVsOiAnSElHSCcsXG4gICAgICAgIHJlcXVpcmVzTUZBOiBmYWxzZVxuICAgICAgfVxuICAgIF1cbiAgfVxuXG4gIGlmIChyb2xlID09PSAnVEVDSE5JQ0lBTicpIHtcbiAgICByZXR1cm4gW1xuICAgICAgLi4uYmFzZVBlcm1pc3Npb25zLFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ2VxdWlwbWVudCcsXG4gICAgICAgIGFjdGlvbnM6IFsndmlldycsICdlZGl0J10sXG4gICAgICAgIHNjb3BlOiAnQUxMJyxcbiAgICAgICAgcmlza0xldmVsOiAnTUVESVVNJyxcbiAgICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZXNvdXJjZTogJ3RpY2tldHMnLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXdfYWxsJywgJ2VkaXRfYWxsJywgJ2Fzc2lnbicsICdjbG9zZSddLFxuICAgICAgICBzY29wZTogJ0FMTCcsXG4gICAgICAgIHJpc2tMZXZlbDogJ0xPVycsXG4gICAgICAgIHJlcXVpcmVzTUZBOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcmVzb3VyY2U6ICdpbnZlbnRvcnknLFxuICAgICAgICBhY3Rpb25zOiBbJ3ZpZXcnLCAnZWRpdCcsICdhc3NpZ24nXSxcbiAgICAgICAgc2NvcGU6ICdBTEwnLFxuICAgICAgICByaXNrTGV2ZWw6ICdNRURJVU0nLFxuICAgICAgICByZXF1aXJlc01GQTogZmFsc2VcbiAgICAgIH1cbiAgICBdXG4gIH1cblxuICAvLyBEZWZhdWx0IHBlcm1pc3Npb25zIGZvciBVU0VSL0VNUExPWUVFIHJvbGVzXG4gIHJldHVybiBbXG4gICAgLi4uYmFzZVBlcm1pc3Npb25zLFxuICAgIHtcbiAgICAgIHJlc291cmNlOiAndGlja2V0cycsXG4gICAgICBhY3Rpb25zOiBbJ3ZpZXdfb3duJywgJ2NyZWF0ZScsICdlZGl0X293biddLFxuICAgICAgc2NvcGU6ICdPV04nLFxuICAgICAgcmlza0xldmVsOiAnTE9XJyxcbiAgICAgIHJlcXVpcmVzTUZBOiBmYWxzZVxuICAgIH0sXG4gICAge1xuICAgICAgcmVzb3VyY2U6ICdlcXVpcG1lbnQnLFxuICAgICAgYWN0aW9uczogWyd2aWV3J10sXG4gICAgICBzY29wZTogJ0FMTCcsXG4gICAgICByaXNrTGV2ZWw6ICdMT1cnLFxuICAgICAgcmVxdWlyZXNNRkE6IGZhbHNlXG4gICAgfVxuICBdXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIndpdGhEYXRhYmFzZSIsInJlcXVpcmVBdXRoIiwiQXV0aEVycm9yIiwiaGVhZGVycyIsIkdFVCIsInJlcSIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJyZXF1ZXN0SWQiLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHJpbmciLCJoZWFkZXJzTGlzdCIsInVzZXJBZ2VudCIsImdldCIsImlwQWRkcmVzcyIsImNvbnNvbGUiLCJsb2ciLCJjdHgiLCJ1c2VySWQiLCJhdXRoRXJyb3IiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwiY29kZSIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwic3RhdHVzIiwidXNlciIsInByaXNtYSIsInVzZXJEYXRhIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaWQiLCJzZWxlY3QiLCJ1c2VybmFtZSIsInJvbGUiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJ1c2VyUHJvZmlsZSIsImlzQWN0aXZlIiwiaXNFbWFpbFZlcmlmaWVkIiwidHdvRmFjdG9yRW5hYmxlZCIsInJvbGVzIiwibmFtZSIsImRpc3BsYXlOYW1lIiwiZ2V0Um9sZURpc3BsYXlOYW1lIiwibGV2ZWwiLCJnZXRSb2xlTGV2ZWwiLCJpc1ByaW1hcnkiLCJpc1RlbXBvcmFyeSIsImFzc2lnbmVkQXQiLCJjb2xvciIsImdldFJvbGVDb2xvciIsImljb24iLCJnZXRSb2xlSWNvbiIsImRpc2NvcmRSb2xlcyIsInBlcm1pc3Npb25zIiwiZ2V0UGVybWlzc2lvbnNGb3JSb2xlIiwiZGVuaWVkUGVybWlzc2lvbnMiLCJzZXR0aW5ncyIsInRpbWV6b25lIiwibG9jYWxlIiwidGhlbWUiLCJzZWN1cml0eSIsInNlc3Npb25Db3VudCIsInJlcXVpcmVzUGFzc3dvcmRDaGFuZ2UiLCJtZmFSZXF1aXJlZCIsIm1ldGFkYXRhIiwicm9sZU5hbWVzIiwicm9sZUxldmVscyIsInJvbGVDb2xvcnMiLCJyb2xlSWNvbnMiLCJiYXNlUGVybWlzc2lvbnMiLCJyZXNvdXJjZSIsImFjdGlvbnMiLCJzY29wZSIsInJpc2tMZXZlbCIsInJlcXVpcmVzTUZBIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/me/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decodeTokenPayload: () => (/* binding */ decodeTokenPayload),\n/* harmony export */   generateResetToken: () => (/* binding */ generateResetToken),\n/* harmony export */   getTokenFromAuthHeader: () => (/* binding */ getTokenFromAuthHeader),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   isTokenNearExpiry: () => (/* binding */ isTokenNearExpiry),\n/* harmony export */   logSecurityEvent: () => (/* binding */ logSecurityEvent),\n/* harmony export */   signJwt: () => (/* binding */ signJwt),\n/* harmony export */   validatePasswordStrength: () => (/* binding */ validatePasswordStrength),\n/* harmony export */   verifyJwt: () => (/* binding */ verifyJwt),\n/* harmony export */   verifyJwtWithError: () => (/* binding */ verifyJwtWithError),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"change-this-secret-in-production-2024\";\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || \"24h\";\nasync function hashPassword(plain) {\n    if (!plain || typeof plain !== 'string') {\n        throw new Error('Password is required and must be string');\n    }\n    if (plain.length < 3) {\n        throw new Error('Password must have at least 3 characters');\n    }\n    if (plain.length > 72) {\n        throw new Error('Password too long (maximum 72 characters)');\n    }\n    try {\n        const saltRounds =  false ? 0 : 10;\n        const salt = await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().genSalt(saltRounds);\n        return await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().hash(plain, salt);\n    } catch (error) {\n        throw new Error('Error hashing password');\n    }\n}\nasync function verifyPassword(plain, hash) {\n    if (!plain || !hash || typeof plain !== 'string' || typeof hash !== 'string') {\n        try {\n            await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().compare('dummy', '$2b$10$N9qo8uLOickgx2ZMRZoMye.3g65c5u4yZfKgKg1uv8XOm6sFBQ.6m');\n        } catch  {\n        // Ignore\n        }\n        return false;\n    }\n    try {\n        return await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().compare(plain, hash);\n    } catch (error) {\n        try {\n            await bcrypt__WEBPACK_IMPORTED_MODULE_0___default().compare('dummy', '$2b$10$N9qo8uLOickgx2ZMRZoMye.3g65c5u4yZfKgKg1uv8XOm6sFBQ.6m');\n        } catch  {\n        // Ignore\n        }\n        return false;\n    }\n}\nfunction signJwt(payload) {\n    if (!payload || typeof payload !== 'object') {\n        throw new Error('Payload must be a valid object');\n    }\n    if ('userId' in payload && (typeof payload.userId !== 'number' || payload.userId <= 0)) {\n        throw new Error('userId must be a positive number');\n    }\n    if ('username' in payload && (typeof payload.username !== 'string' || !payload.username.trim())) {\n        throw new Error('username must be a non-empty string');\n    }\n    if ('role' in payload && (typeof payload.role !== 'string' || !payload.role.trim())) {\n        throw new Error('role must be a non-empty string');\n    }\n    try {\n        const hasExp = 'exp' in payload && typeof payload.exp === 'number';\n        if (hasExp) {\n            return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign(payload, JWT_SECRET, {\n                issuer: 'sistema-it',\n                audience: 'sistema-it-users'\n            });\n        } else {\n            return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign(payload, JWT_SECRET, {\n                expiresIn: JWT_EXPIRES_IN,\n                issuer: 'sistema-it',\n                audience: 'sistema-it-users'\n            });\n        }\n    } catch (error) {\n        throw new Error('Error generating JWT token');\n    }\n}\nfunction verifyJwt(token) {\n    if (!token || typeof token !== 'string') {\n        return null;\n    }\n    const cleanToken = token.replace(/^Bearer\\s+/i, '').trim();\n    if (cleanToken.length === 0) {\n        return null;\n    }\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(cleanToken, JWT_SECRET, {\n            issuer: 'sistema-it',\n            audience: 'sistema-it-users',\n            clockTolerance: 30\n        });\n        if (!decoded || typeof decoded !== 'object') {\n            return null;\n        }\n        return decoded;\n    } catch (error) {\n        return null;\n    }\n}\nfunction verifyJwtWithError(token) {\n    if (!token || typeof token !== 'string') {\n        return {\n            payload: null,\n            error: 'Token is required',\n            errorCode: 'TOKEN_REQUIRED'\n        };\n    }\n    const cleanToken = token.replace(/^Bearer\\s+/i, '').trim();\n    if (cleanToken.length === 0) {\n        return {\n            payload: null,\n            error: 'Empty token',\n            errorCode: 'EMPTY_TOKEN'\n        };\n    }\n    const tokenParts = cleanToken.split('.');\n    if (tokenParts.length !== 3) {\n        return {\n            payload: null,\n            error: 'Invalid token format',\n            errorCode: 'INVALID_TOKEN_FORMAT'\n        };\n    }\n    try {\n        const payload = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(cleanToken, JWT_SECRET, {\n            issuer: 'sistema-it',\n            audience: 'sistema-it-users',\n            clockTolerance: 30\n        });\n        if (!payload || typeof payload !== 'object') {\n            return {\n                payload: null,\n                error: 'Invalid token payload',\n                errorCode: 'INVALID_PAYLOAD'\n            };\n        }\n        return {\n            payload,\n            error: null,\n            errorCode: null\n        };\n    } catch (error) {\n        if (error instanceof (jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().TokenExpiredError)) {\n            return {\n                payload: null,\n                error: 'Your session has expired. Please login again.',\n                errorCode: 'TOKEN_EXPIRED'\n            };\n        } else if (error instanceof (jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().JsonWebTokenError)) {\n            return {\n                payload: null,\n                error: 'Invalid authentication token.',\n                errorCode: 'INVALID_TOKEN'\n            };\n        } else if (error instanceof (jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().NotBeforeError)) {\n            return {\n                payload: null,\n                error: 'Token is not valid yet.',\n                errorCode: 'TOKEN_NOT_ACTIVE'\n            };\n        } else {\n            return {\n                payload: null,\n                error: 'Authentication error.',\n                errorCode: 'AUTH_ERROR'\n            };\n        }\n    }\n}\nfunction getTokenFromAuthHeader(authorization) {\n    if (!authorization || typeof authorization !== 'string') {\n        return null;\n    }\n    const parts = authorization.trim().split(' ');\n    if (parts.length !== 2) {\n        return null;\n    }\n    const [type, token] = parts;\n    if (type.toLowerCase() !== 'bearer' || !token || token.length === 0) {\n        return null;\n    }\n    return token;\n}\nfunction validatePasswordStrength(password) {\n    const errors = [];\n    let score = 0;\n    if (!password || typeof password !== 'string') {\n        return {\n            isValid: false,\n            errors: [\n                'Password is required'\n            ],\n            score: 0\n        };\n    }\n    if (password.length < 6) {\n        errors.push('Password must be at least 6 characters long');\n    } else if (password.length >= 8) {\n        score += 1;\n    }\n    if (!/[a-z]/.test(password)) {\n        errors.push('Password must contain at least one lowercase letter');\n    } else {\n        score += 1;\n    }\n    if (!/[A-Z]/.test(password)) {\n        errors.push('Password must contain at least one uppercase letter');\n    } else {\n        score += 1;\n    }\n    if (!/\\d/.test(password)) {\n        errors.push('Password must contain at least one number');\n    } else {\n        score += 1;\n    }\n    if (!/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n        errors.push('Password must contain at least one special character');\n    } else {\n        score += 1;\n    }\n    const isValid = errors.length === 0 && password.length >= 6;\n    return {\n        isValid,\n        errors,\n        score: Math.max(0, Math.min(5, score))\n    };\n}\nfunction generateResetToken() {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    for(let i = 0; i < 32; i++){\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result + '-' + Date.now().toString(36);\n}\nfunction isTokenNearExpiry(token, thresholdMinutes = 5) {\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().decode(token);\n        if (!decoded || !decoded.exp) return false;\n        const expirationTime = decoded.exp * 1000;\n        const currentTime = Date.now();\n        const thresholdTime = thresholdMinutes * 60 * 1000;\n        return expirationTime - currentTime < thresholdTime;\n    } catch (error) {\n        return true;\n    }\n}\nfunction logSecurityEvent(event, details) {\n    const logEntry = {\n        timestamp: new Date().toISOString(),\n        event,\n        ...details,\n        requestId: Math.random().toString(36).substring(7)\n    };\n    console.log('[SECURITY]', JSON.stringify(logEntry));\n}\nfunction decodeTokenPayload(token) {\n    try {\n        const cleanToken = token.replace(/^Bearer\\s+/i, '').trim();\n        return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().decode(cleanToken);\n    } catch (error) {\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBQWdCSixtQkFBbUIsS0FBSztRQUU5QyxPQUFPLGlCQUFrQkcsY0FBZUM7SUFDMUMsRUFBRSxPQUFPM0QsT0FBTztRQUNkLE9BQU87SUFDVDtBQUNGO0FBRU8sU0FBUzRELGlCQUNkQyxLQUFhLEVBQ2JDLE9BT0M7SUFFRCxNQUFNQyxXQUFXO1FBQ2ZDLFdBQVcsSUFBSWIsT0FBT2MsV0FBVztRQUNqQ0o7UUFDQSxHQUFHQyxPQUFPO1FBQ1ZJLFdBQVd6QixLQUFLUyxNQUFNLEdBQUdHLFFBQVEsQ0FBQyxJQUFJYyxTQUFTLENBQUM7SUFDbEQ7SUFFQUMsUUFBUUMsR0FBRyxDQUFDLGNBQWNDLEtBQUtDLFNBQVMsQ0FBQ1I7QUFDM0M7QUFFTyxTQUFTUyxtQkFBbUJ4RCxLQUFhO0lBQzlDLElBQUk7UUFDRixNQUFNQyxhQUFhRCxNQUFNRSxPQUFPLENBQUMsZUFBZSxJQUFJWCxJQUFJO1FBQ3hELE9BQU9wQiwwREFBVSxDQUFDOEI7SUFDcEIsRUFBRSxPQUFPakIsT0FBTztRQUNkLE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEF1eFNpc3RlbWFzXFxEb2N1bWVudHNcXHNpc3RlbWFzXFxzaXN0XFxzaXN0ZW1hXFxsaWJcXGF1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJjcnlwdCBmcm9tIFwiYmNyeXB0XCI7XG5pbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcblxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgXCJjaGFuZ2UtdGhpcy1zZWNyZXQtaW4tcHJvZHVjdGlvbi0yMDI0XCI7XG5jb25zdCBKV1RfRVhQSVJFU19JTjogc3RyaW5nID0gcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgXCIyNGhcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hQYXNzd29yZChwbGFpbjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgaWYgKCFwbGFpbiB8fCB0eXBlb2YgcGxhaW4gIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQYXNzd29yZCBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBzdHJpbmcnKTtcbiAgfVxuXG4gIGlmIChwbGFpbi5sZW5ndGggPCAzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdQYXNzd29yZCBtdXN0IGhhdmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzJyk7XG4gIH1cblxuICBpZiAocGxhaW4ubGVuZ3RoID4gNzIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bhc3N3b3JkIHRvbyBsb25nIChtYXhpbXVtIDcyIGNoYXJhY3RlcnMpJyk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHNhbHRSb3VuZHMgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gMTIgOiAxMDtcbiAgICBjb25zdCBzYWx0ID0gYXdhaXQgYmNyeXB0LmdlblNhbHQoc2FsdFJvdW5kcyk7XG4gICAgcmV0dXJuIGF3YWl0IGJjcnlwdC5oYXNoKHBsYWluLCBzYWx0KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Vycm9yIGhhc2hpbmcgcGFzc3dvcmQnKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UGFzc3dvcmQocGxhaW46IHN0cmluZywgaGFzaDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGlmICghcGxhaW4gfHwgIWhhc2ggfHwgdHlwZW9mIHBsYWluICE9PSAnc3RyaW5nJyB8fCB0eXBlb2YgaGFzaCAhPT0gJ3N0cmluZycpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYmNyeXB0LmNvbXBhcmUoJ2R1bW15JywgJyQyYiQxMCROOXFvOHVMT2lja2d4MlpNUlpvTXllLjNnNjVjNXU0eVpmS2dLZzF1djhYT202c0ZCUS42bScpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gSWdub3JlXG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGJjcnlwdC5jb21wYXJlKHBsYWluLCBoYXNoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYmNyeXB0LmNvbXBhcmUoJ2R1bW15JywgJyQyYiQxMCROOXFvOHVMT2lja2d4MlpNUlpvTXllLjNnNjVjNXU0eVpmS2dLZzF1djhYT202c0ZCUS42bScpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gSWdub3JlXG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2lnbkp3dChwYXlsb2FkOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogc3RyaW5nIHtcbiAgaWYgKCFwYXlsb2FkIHx8IHR5cGVvZiBwYXlsb2FkICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBFcnJvcignUGF5bG9hZCBtdXN0IGJlIGEgdmFsaWQgb2JqZWN0Jyk7XG4gIH1cblxuICBpZiAoJ3VzZXJJZCcgaW4gcGF5bG9hZCAmJiAodHlwZW9mIHBheWxvYWQudXNlcklkICE9PSAnbnVtYmVyJyB8fCBwYXlsb2FkLnVzZXJJZCA8PSAwKSkge1xuICAgIHRocm93IG5ldyBFcnJvcigndXNlcklkIG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtcbiAgfVxuXG4gIGlmICgndXNlcm5hbWUnIGluIHBheWxvYWQgJiYgKHR5cGVvZiBwYXlsb2FkLnVzZXJuYW1lICE9PSAnc3RyaW5nJyB8fCAhcGF5bG9hZC51c2VybmFtZS50cmltKCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd1c2VybmFtZSBtdXN0IGJlIGEgbm9uLWVtcHR5IHN0cmluZycpO1xuICB9XG5cbiAgaWYgKCdyb2xlJyBpbiBwYXlsb2FkICYmICh0eXBlb2YgcGF5bG9hZC5yb2xlICE9PSAnc3RyaW5nJyB8fCAhcGF5bG9hZC5yb2xlLnRyaW0oKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3JvbGUgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcnKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgaGFzRXhwID0gJ2V4cCcgaW4gcGF5bG9hZCAmJiB0eXBlb2YgcGF5bG9hZC5leHAgPT09ICdudW1iZXInO1xuXG4gICAgaWYgKGhhc0V4cCkge1xuICAgICAgcmV0dXJuIGp3dC5zaWduKHBheWxvYWQsIEpXVF9TRUNSRVQsIHtcbiAgICAgICAgaXNzdWVyOiAnc2lzdGVtYS1pdCcsXG4gICAgICAgIGF1ZGllbmNlOiAnc2lzdGVtYS1pdC11c2VycycsXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGp3dC5zaWduKHBheWxvYWQsIEpXVF9TRUNSRVQsIHsgXG4gICAgICAgIGV4cGlyZXNJbjogSldUX0VYUElSRVNfSU4sXG4gICAgICAgIGlzc3VlcjogJ3Npc3RlbWEtaXQnLFxuICAgICAgICBhdWRpZW5jZTogJ3Npc3RlbWEtaXQtdXNlcnMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgZ2VuZXJhdGluZyBKV1QgdG9rZW4nKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5Snd0PFQgZXh0ZW5kcyBvYmplY3QgPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4odG9rZW46IHN0cmluZyk6IFQgfCBudWxsIHtcbiAgaWYgKCF0b2tlbiB8fCB0eXBlb2YgdG9rZW4gIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBjbGVhblRva2VuID0gdG9rZW4ucmVwbGFjZSgvXkJlYXJlclxccysvaSwgJycpLnRyaW0oKTtcbiAgXG4gIGlmIChjbGVhblRva2VuLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeShjbGVhblRva2VuLCBKV1RfU0VDUkVULCB7XG4gICAgICBpc3N1ZXI6ICdzaXN0ZW1hLWl0JyxcbiAgICAgIGF1ZGllbmNlOiAnc2lzdGVtYS1pdC11c2VycycsXG4gICAgICBjbG9ja1RvbGVyYW5jZTogMzAsXG4gICAgfSkgYXMgVDtcblxuICAgIGlmICghZGVjb2RlZCB8fCB0eXBlb2YgZGVjb2RlZCAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBkZWNvZGVkO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2ZXJpZnlKd3RXaXRoRXJyb3I8VCBleHRlbmRzIG9iamVjdCA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+Pih0b2tlbjogc3RyaW5nKToge1xuICBwYXlsb2FkOiBUIHwgbnVsbCxcbiAgZXJyb3I6IHN0cmluZyB8IG51bGwsXG4gIGVycm9yQ29kZTogc3RyaW5nIHwgbnVsbFxufSB7XG4gIGlmICghdG9rZW4gfHwgdHlwZW9mIHRva2VuICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB7XG4gICAgICBwYXlsb2FkOiBudWxsLFxuICAgICAgZXJyb3I6ICdUb2tlbiBpcyByZXF1aXJlZCcsXG4gICAgICBlcnJvckNvZGU6ICdUT0tFTl9SRVFVSVJFRCdcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgY2xlYW5Ub2tlbiA9IHRva2VuLnJlcGxhY2UoL15CZWFyZXJcXHMrL2ksICcnKS50cmltKCk7XG4gIFxuICBpZiAoY2xlYW5Ub2tlbi5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGF5bG9hZDogbnVsbCxcbiAgICAgIGVycm9yOiAnRW1wdHkgdG9rZW4nLFxuICAgICAgZXJyb3JDb2RlOiAnRU1QVFlfVE9LRU4nXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IHRva2VuUGFydHMgPSBjbGVhblRva2VuLnNwbGl0KCcuJyk7XG4gIGlmICh0b2tlblBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgIHJldHVybiB7XG4gICAgICBwYXlsb2FkOiBudWxsLFxuICAgICAgZXJyb3I6ICdJbnZhbGlkIHRva2VuIGZvcm1hdCcsXG4gICAgICBlcnJvckNvZGU6ICdJTlZBTElEX1RPS0VOX0ZPUk1BVCdcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwYXlsb2FkID0gand0LnZlcmlmeShjbGVhblRva2VuLCBKV1RfU0VDUkVULCB7XG4gICAgICBpc3N1ZXI6ICdzaXN0ZW1hLWl0JyxcbiAgICAgIGF1ZGllbmNlOiAnc2lzdGVtYS1pdC11c2VycycsXG4gICAgICBjbG9ja1RvbGVyYW5jZTogMzAsXG4gICAgfSkgYXMgVDtcblxuICAgIGlmICghcGF5bG9hZCB8fCB0eXBlb2YgcGF5bG9hZCAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBheWxvYWQ6IG51bGwsXG4gICAgICAgIGVycm9yOiAnSW52YWxpZCB0b2tlbiBwYXlsb2FkJyxcbiAgICAgICAgZXJyb3JDb2RlOiAnSU5WQUxJRF9QQVlMT0FEJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBwYXlsb2FkLCBlcnJvcjogbnVsbCwgZXJyb3JDb2RlOiBudWxsIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBqd3QuVG9rZW5FeHBpcmVkRXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBheWxvYWQ6IG51bGwsXG4gICAgICAgIGVycm9yOiAnWW91ciBzZXNzaW9uIGhhcyBleHBpcmVkLiBQbGVhc2UgbG9naW4gYWdhaW4uJyxcbiAgICAgICAgZXJyb3JDb2RlOiAnVE9LRU5fRVhQSVJFRCdcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIGp3dC5Kc29uV2ViVG9rZW5FcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGF5bG9hZDogbnVsbCxcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHRva2VuLicsXG4gICAgICAgIGVycm9yQ29kZTogJ0lOVkFMSURfVE9LRU4nXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBqd3QuTm90QmVmb3JlRXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBheWxvYWQ6IG51bGwsXG4gICAgICAgIGVycm9yOiAnVG9rZW4gaXMgbm90IHZhbGlkIHlldC4nLFxuICAgICAgICBlcnJvckNvZGU6ICdUT0tFTl9OT1RfQUNUSVZFJ1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGF5bG9hZDogbnVsbCxcbiAgICAgICAgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiBlcnJvci4nLFxuICAgICAgICBlcnJvckNvZGU6ICdBVVRIX0VSUk9SJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRva2VuRnJvbUF1dGhIZWFkZXIoYXV0aG9yaXphdGlvbj86IHN0cmluZyB8IG51bGwpOiBzdHJpbmcgfCBudWxsIHtcbiAgaWYgKCFhdXRob3JpemF0aW9uIHx8IHR5cGVvZiBhdXRob3JpemF0aW9uICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgcGFydHMgPSBhdXRob3JpemF0aW9uLnRyaW0oKS5zcGxpdCgnICcpO1xuICBpZiAocGFydHMubGVuZ3RoICE9PSAyKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBbdHlwZSwgdG9rZW5dID0gcGFydHM7XG4gIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgIT09ICdiZWFyZXInIHx8ICF0b2tlbiB8fCB0b2tlbi5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB0b2tlbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aChwYXNzd29yZDogc3RyaW5nKToge1xuICBpc1ZhbGlkOiBib29sZWFuO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICBzY29yZTogbnVtYmVyO1xufSB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgbGV0IHNjb3JlID0gMDtcblxuICBpZiAoIXBhc3N3b3JkIHx8IHR5cGVvZiBwYXNzd29yZCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3JzOiBbJ1Bhc3N3b3JkIGlzIHJlcXVpcmVkJ10sIHNjb3JlOiAwIH07XG4gIH1cblxuICBpZiAocGFzc3dvcmQubGVuZ3RoIDwgNikge1xuICAgIGVycm9ycy5wdXNoKCdQYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDYgY2hhcmFjdGVycyBsb25nJyk7XG4gIH0gZWxzZSBpZiAocGFzc3dvcmQubGVuZ3RoID49IDgpIHtcbiAgICBzY29yZSArPSAxO1xuICB9XG5cbiAgaWYgKCEvW2Etel0vLnRlc3QocGFzc3dvcmQpKSB7XG4gICAgZXJyb3JzLnB1c2goJ1Bhc3N3b3JkIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgbG93ZXJjYXNlIGxldHRlcicpO1xuICB9IGVsc2Uge1xuICAgIHNjb3JlICs9IDE7XG4gIH1cblxuICBpZiAoIS9bQS1aXS8udGVzdChwYXNzd29yZCkpIHtcbiAgICBlcnJvcnMucHVzaCgnUGFzc3dvcmQgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSB1cHBlcmNhc2UgbGV0dGVyJyk7XG4gIH0gZWxzZSB7XG4gICAgc2NvcmUgKz0gMTtcbiAgfVxuXG4gIGlmICghL1xcZC8udGVzdChwYXNzd29yZCkpIHtcbiAgICBlcnJvcnMucHVzaCgnUGFzc3dvcmQgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSBudW1iZXInKTtcbiAgfSBlbHNlIHtcbiAgICBzY29yZSArPSAxO1xuICB9XG5cbiAgaWYgKCEvWyFAIyQlXiYqKCksLj9cIjp7fXw8Pl0vLnRlc3QocGFzc3dvcmQpKSB7XG4gICAgZXJyb3JzLnB1c2goJ1Bhc3N3b3JkIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgc3BlY2lhbCBjaGFyYWN0ZXInKTtcbiAgfSBlbHNlIHtcbiAgICBzY29yZSArPSAxO1xuICB9XG5cbiAgY29uc3QgaXNWYWxpZCA9IGVycm9ycy5sZW5ndGggPT09IDAgJiYgcGFzc3dvcmQubGVuZ3RoID49IDY7XG4gIFxuICByZXR1cm4ge1xuICAgIGlzVmFsaWQsXG4gICAgZXJyb3JzLFxuICAgIHNjb3JlOiBNYXRoLm1heCgwLCBNYXRoLm1pbig1LCBzY29yZSkpXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVJlc2V0VG9rZW4oKTogc3RyaW5nIHtcbiAgY29uc3QgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknO1xuICBsZXQgcmVzdWx0ID0gJyc7XG4gIFxuICBmb3IgKGxldCBpID0gMDsgaSA8IDMyOyBpKyspIHtcbiAgICByZXN1bHQgKz0gY2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzLmxlbmd0aCkpO1xuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0ICsgJy0nICsgRGF0ZS5ub3coKS50b1N0cmluZygzNik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1Rva2VuTmVhckV4cGlyeSh0b2tlbjogc3RyaW5nLCB0aHJlc2hvbGRNaW51dGVzOiBudW1iZXIgPSA1KTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC5kZWNvZGUodG9rZW4pIGFzIGFueTtcbiAgICBpZiAoIWRlY29kZWQgfHwgIWRlY29kZWQuZXhwKSByZXR1cm4gZmFsc2U7XG4gICAgXG4gICAgY29uc3QgZXhwaXJhdGlvblRpbWUgPSBkZWNvZGVkLmV4cCAqIDEwMDA7XG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHRocmVzaG9sZFRpbWUgPSB0aHJlc2hvbGRNaW51dGVzICogNjAgKiAxMDAwO1xuICAgIFxuICAgIHJldHVybiAoZXhwaXJhdGlvblRpbWUgLSBjdXJyZW50VGltZSkgPCB0aHJlc2hvbGRUaW1lO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dTZWN1cml0eUV2ZW50KFxuICBldmVudDogc3RyaW5nLFxuICBkZXRhaWxzOiB7XG4gICAgdXNlcklkPzogbnVtYmVyO1xuICAgIHVzZXJuYW1lPzogc3RyaW5nO1xuICAgIGlwPzogc3RyaW5nO1xuICAgIHVzZXJBZ2VudD86IHN0cmluZztcbiAgICBzdWNjZXNzPzogYm9vbGVhbjtcbiAgICBlcnJvcj86IHN0cmluZztcbiAgfVxuKTogdm9pZCB7XG4gIGNvbnN0IGxvZ0VudHJ5ID0ge1xuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIGV2ZW50LFxuICAgIC4uLmRldGFpbHMsXG4gICAgcmVxdWVzdElkOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNylcbiAgfTtcblxuICBjb25zb2xlLmxvZygnW1NFQ1VSSVRZXScsIEpTT04uc3RyaW5naWZ5KGxvZ0VudHJ5KSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNvZGVUb2tlblBheWxvYWQodG9rZW46IHN0cmluZyk6IGFueSB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xlYW5Ub2tlbiA9IHRva2VuLnJlcGxhY2UoL15CZWFyZXJcXHMrL2ksICcnKS50cmltKCk7XG4gICAgcmV0dXJuIGp3dC5kZWNvZGUoY2xlYW5Ub2tlbik7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn0iXSwibmFtZXMiOlsiYmNyeXB0Iiwiand0IiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfRVhQSVJFU19JTiIsImhhc2hQYXNzd29yZCIsInBsYWluIiwiRXJyb3IiLCJsZW5ndGgiLCJzYWx0Um91bmRzIiwic2FsdCIsImdlblNhbHQiLCJoYXNoIiwiZXJyb3IiLCJ2ZXJpZnlQYXNzd29yZCIsImNvbXBhcmUiLCJzaWduSnd0IiwicGF5bG9hZCIsInVzZXJJZCIsInVzZXJuYW1lIiwidHJpbSIsInJvbGUiLCJoYXNFeHAiLCJleHAiLCJzaWduIiwiaXNzdWVyIiwiYXVkaWVuY2UiLCJleHBpcmVzSW4iLCJ2ZXJpZnlKd3QiLCJ0b2tlbiIsImNsZWFuVG9rZW4iLCJyZXBsYWNlIiwiZGVjb2RlZCIsInZlcmlmeSIsImNsb2NrVG9sZXJhbmNlIiwidmVyaWZ5Snd0V2l0aEVycm9yIiwiZXJyb3JDb2RlIiwidG9rZW5QYXJ0cyIsInNwbGl0IiwiVG9rZW5FeHBpcmVkRXJyb3IiLCJKc29uV2ViVG9rZW5FcnJvciIsIk5vdEJlZm9yZUVycm9yIiwiZ2V0VG9rZW5Gcm9tQXV0aEhlYWRlciIsImF1dGhvcml6YXRpb24iLCJwYXJ0cyIsInR5cGUiLCJ0b0xvd2VyQ2FzZSIsInZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCIsInBhc3N3b3JkIiwiZXJyb3JzIiwic2NvcmUiLCJpc1ZhbGlkIiwicHVzaCIsInRlc3QiLCJNYXRoIiwibWF4IiwibWluIiwiZ2VuZXJhdGVSZXNldFRva2VuIiwiY2hhcnMiLCJyZXN1bHQiLCJpIiwiY2hhckF0IiwiZmxvb3IiLCJyYW5kb20iLCJEYXRlIiwibm93IiwidG9TdHJpbmciLCJpc1Rva2VuTmVhckV4cGlyeSIsInRocmVzaG9sZE1pbnV0ZXMiLCJkZWNvZGUiLCJleHBpcmF0aW9uVGltZSIsImN1cnJlbnRUaW1lIiwidGhyZXNob2xkVGltZSIsImxvZ1NlY3VyaXR5RXZlbnQiLCJldmVudCIsImRldGFpbHMiLCJsb2dFbnRyeSIsInRpbWVzdGFtcCIsInRvSVNPU3RyaW5nIiwicmVxdWVzdElkIiwic3Vic3RyaW5nIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWNvZGVUb2tlblBheWxvYWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/middleware.ts":
/*!***************************!*\
  !*** ./lib/middleware.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuthError: () => (/* binding */ AuthError),\n/* harmony export */   compareRoleLevel: () => (/* binding */ compareRoleLevel),\n/* harmony export */   getUserFromToken: () => (/* binding */ getUserFromToken),\n/* harmony export */   isValidRole: () => (/* binding */ isValidRole),\n/* harmony export */   logSecurityEvent: () => (/* binding */ logSecurityEvent),\n/* harmony export */   requireAdmin: () => (/* binding */ requireAdmin),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   requirePermission: () => (/* binding */ requirePermission),\n/* harmony export */   requireRole: () => (/* binding */ requireRole),\n/* harmony export */   requireTechnician: () => (/* binding */ requireTechnician),\n/* harmony export */   withAuth: () => (/* binding */ withAuth),\n/* harmony export */   withAuthAndRole: () => (/* binding */ withAuthAndRole)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n\n\n/**\n * Clase para errores de autenticaciÃ³n\n */ class AuthError extends Error {\n    constructor(message, code, status = 401){\n        super(message), this.code = code, this.status = status;\n        this.name = 'AuthError';\n    }\n}\n/**\n * FUNCIÃ“N PRINCIPAL: requireAuth - Extraer y verificar autenticaciÃ³n\n * Corrige problemas de \"Cannot read properties of undefined\"\n */ function requireAuth(req) {\n    try {\n        // CORRECCIÃ“N: Extraer token de forma segura\n        let token = null;\n        try {\n            // 1. Intentar desde cookies (mÃ¡s seguro)\n            const cookieToken = req.cookies?.get('auth_token')?.value;\n            if (cookieToken && typeof cookieToken === 'string') {\n                token = cookieToken.trim();\n            }\n            // 2. Si no hay cookie, intentar desde Authorization header (para APIs)\n            if (!token) {\n                const authHeader = req.headers?.get('Authorization');\n                if (authHeader && typeof authHeader === 'string') {\n                    const headerToken = authHeader.replace(/^Bearer\\s+/i, '').trim();\n                    if (headerToken.length > 0) {\n                        token = headerToken;\n                    }\n                }\n            }\n        } catch (tokenError) {\n            console.warn('Error extrayendo token:', tokenError);\n            token = null;\n        }\n        if (!token) {\n            throw new AuthError('Token de autenticaciÃ³n requerido', 'TOKEN_REQUIRED', 401);\n        }\n        // CORRECCIÃ“N: Verificar token JWT con manejo robusto de errores\n        const { payload, error, errorCode } = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyJwtWithError)(token);\n        if (error || !payload) {\n            throw new AuthError(error || 'Token invÃ¡lido', errorCode || 'INVALID_TOKEN', 401);\n        }\n        // CORRECCIÃ“N: Validar estructura del payload para evitar undefined\n        if (!payload.userId || typeof payload.userId !== 'number') {\n            throw new AuthError('ID de usuario invÃ¡lido en token', 'INVALID_USER_ID', 401);\n        }\n        if (!payload.username || typeof payload.username !== 'string') {\n            throw new AuthError('Nombre de usuario invÃ¡lido en token', 'INVALID_USERNAME', 401);\n        }\n        if (!payload.role || typeof payload.role !== 'string') {\n            throw new AuthError('Rol de usuario invÃ¡lido en token', 'INVALID_ROLE', 401);\n        }\n        // Crear contexto de autenticaciÃ³n vÃ¡lido\n        const context = {\n            userId: payload.userId,\n            username: payload.username.toLowerCase().trim(),\n            role: payload.role.toUpperCase().trim(),\n            token: token\n        };\n        return context;\n    } catch (error) {\n        if (error instanceof AuthError) {\n            throw error;\n        }\n        console.error('Error inesperado en requireAuth:', error);\n        throw new AuthError('Error de autenticaciÃ³n', 'AUTH_ERROR', 401);\n    }\n}\n/**\n * FUNCIÃ“N: requireRole - Verificar roles especÃ­ficos\n * Corrige problemas con verificaciÃ³n de roles undefined\n */ function requireRole(context, allowedRoles) {\n    try {\n        // CORRECCIÃ“N: Validar contexto de entrada\n        if (!context || typeof context !== 'object') {\n            throw new AuthError('Contexto de autenticaciÃ³n invÃ¡lido', 'INVALID_CONTEXT', 401);\n        }\n        if (!context.role || typeof context.role !== 'string') {\n            throw new AuthError('Rol no vÃ¡lido en contexto', 'INVALID_ROLE', 401);\n        }\n        // CORRECCIÃ“N: Validar roles permitidos\n        if (!allowedRoles || !Array.isArray(allowedRoles) || allowedRoles.length === 0) {\n            throw new AuthError('Roles permitidos no especificados', 'NO_ROLES_SPECIFIED', 500);\n        }\n        // Normalizar roles para comparaciÃ³n case-insensitive\n        const userRole = context.role.toUpperCase().trim();\n        const normalizedAllowedRoles = allowedRoles.filter((role)=>role && typeof role === 'string').map((role)=>role.toUpperCase().trim());\n        if (normalizedAllowedRoles.length === 0) {\n            throw new AuthError('No hay roles vÃ¡lidos especificados', 'NO_VALID_ROLES', 500);\n        }\n        // CORRECCIÃ“N: Verificar si el usuario tiene uno de los roles permitidos\n        if (!normalizedAllowedRoles.includes(userRole)) {\n            throw new AuthError(`Permisos insuficientes. Se requiere: ${allowedRoles.join(', ')}. Actual: ${context.role}`, 'INSUFFICIENT_PERMISSIONS', 403);\n        }\n    } catch (error) {\n        if (error instanceof AuthError) {\n            throw error;\n        }\n        console.error('Error inesperado en requireRole:', error);\n        throw new AuthError('Error de verificaciÃ³n de roles', 'ROLE_ERROR', 500);\n    }\n}\n/**\n * FUNCIÃ“N: requireAdmin - Verificar permisos de administrador\n */ function requireAdmin(context) {\n    requireRole(context, [\n        'ADMIN',\n        'SUPER_ADMIN'\n    ]);\n}\n/**\n * FUNCIÃ“N: requireTechnician - Verificar permisos tÃ©cnicos o superiores\n */ function requireTechnician(context) {\n    requireRole(context, [\n        'TECHNICIAN',\n        'ADMIN',\n        'SUPER_ADMIN'\n    ]);\n}\n/**\n * MIDDLEWARE WRAPPER: Convertir requireAuth a middleware de NextJS\n * Para uso en rutas API\n */ function withAuth(handler) {\n    return async (req)=>{\n        try {\n            const context = requireAuth(req);\n            return await handler(req, context);\n        } catch (error) {\n            if (error instanceof AuthError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: error.message,\n                    code: error.code,\n                    timestamp: new Date().toISOString()\n                }, {\n                    status: error.status\n                });\n            }\n            console.error('Error en withAuth:', error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Error de autenticaciÃ³n interno',\n                code: 'INTERNAL_AUTH_ERROR'\n            }, {\n                status: 500\n            });\n        }\n    };\n}\n/**\n * MIDDLEWARE WRAPPER: Combinar auth + roles\n */ function withAuthAndRole(allowedRoles, handler) {\n    return withAuth(async (req, context)=>{\n        try {\n            requireRole(context, allowedRoles);\n            return await handler(req, context);\n        } catch (error) {\n            if (error instanceof AuthError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: error.message,\n                    code: error.code,\n                    timestamp: new Date().toISOString()\n                }, {\n                    status: error.status\n                });\n            }\n            console.error('Error en withAuthAndRole:', error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Error de autorizaciÃ³n interno',\n                code: 'INTERNAL_ROLE_ERROR'\n            }, {\n                status: 500\n            });\n        }\n    });\n}\n/**\n * FUNCIÃ“N: requirePermission - Sistema de permisos granulares para producciÃ³n\n * Mapea permisos del nuevo sistema Discord a roles legacy para compatibilidad\n */ function requirePermission(context, permission) {\n    // Mapeo de permisos Discord a roles legacy para compatibilidad\n    const permissionToRoles = {\n        // Dashboard permissions\n        'dashboard:view': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'dashboard:export': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Equipment permissions\n        'equipment:view': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:create': [\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:edit': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:delete': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:export': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Tickets permissions\n        'tickets:view_own': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:view_all': [\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:create': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:edit_own': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:edit_all': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:delete': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:assign': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'tickets:close': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Employees permissions\n        'employees:view': [\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'employees:create': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'employees:edit': [\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'employees:delete': [\n            'SUPER_ADMIN'\n        ],\n        'employees:export': [\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Inventory permissions\n        'inventory:view': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'inventory:create': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'inventory:edit': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'inventory:delete': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'inventory:assign': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Printers permissions\n        'printers:view': [\n            'USER',\n            'EMPLOYEE',\n            'SUPPORT',\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'printers:create': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'printers:edit': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'printers:delete': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'printers:manage_consumables': [\n            'TECHNICIAN',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Purchases permissions\n        'purchases:view': [\n            'USER',\n            'EMPLOYEE',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'purchases:create': [\n            'USER',\n            'EMPLOYEE',\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'purchases:approve': [\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'purchases:reject': [\n            'MANAGER',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'purchases:process': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Backups permissions\n        'backups:view': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'backups:create': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'backups:restore': [\n            'SUPER_ADMIN'\n        ],\n        'backups:delete': [\n            'SUPER_ADMIN'\n        ],\n        // Users & Roles permissions\n        'users:view': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'users:create': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'users:edit': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'users:delete': [\n            'SUPER_ADMIN'\n        ],\n        'users:reset_password': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'roles:view': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'roles:create': [\n            'SUPER_ADMIN'\n        ],\n        'roles:edit': [\n            'SUPER_ADMIN'\n        ],\n        'roles:delete': [\n            'SUPER_ADMIN'\n        ],\n        'roles:assign': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // System permissions\n        'system:configure': [\n            'SUPER_ADMIN'\n        ],\n        'system:admin': [\n            'SUPER_ADMIN'\n        ],\n        'audit:view': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'audit:export': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        // Wildcard permissions\n        '*:*': [\n            'SUPER_ADMIN'\n        ],\n        // Legacy permissions for backward compatibility\n        'users:read': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'users:write': [\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:read': [\n            'TECHNICIAN',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ],\n        'equipment:write': [\n            'TECHNICIAN',\n            'ADMIN',\n            'SUPER_ADMIN'\n        ]\n    };\n    const requiredRoles = permissionToRoles[permission];\n    if (!requiredRoles) {\n        // Si no encuentra el permiso especÃ­fico, rechazar acceso por seguridad\n        throw new AuthError(`Permiso no autorizado: ${permission}`, 'PERMISSION_DENIED', 403);\n    }\n    requireRole(context, requiredRoles);\n}\n/**\n * FUNCIÃ“N HELPER: Obtener informaciÃ³n del usuario desde token\n */ function getUserFromToken(token) {\n    try {\n        const { payload } = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyJwtWithError)(token);\n        if (!payload) return null;\n        return {\n            userId: payload.userId,\n            username: payload.username,\n            role: payload.role,\n            token\n        };\n    } catch (error) {\n        console.warn('Error obteniendo usuario desde token:', error);\n        return null;\n    }\n}\n/**\n * FUNCIÃ“N HELPER: Verificar si un rol es vÃ¡lido\n */ function isValidRole(role) {\n    const validRoles = [\n        'USER',\n        'TECHNICIAN',\n        'ADMIN',\n        'SUPER_ADMIN'\n    ];\n    return validRoles.includes(role?.toUpperCase());\n}\n/**\n * FUNCIÃ“N HELPER: Comparar niveles de roles\n */ function compareRoleLevel(role1, role2) {\n    const roleLevels = {\n        'USER': 10,\n        'TECHNICIAN': 20,\n        'ADMIN': 30,\n        'SUPER_ADMIN': 40\n    };\n    const level1 = roleLevels[role1?.toUpperCase()] || 0;\n    const level2 = roleLevels[role2?.toUpperCase()] || 0;\n    return level1 - level2;\n}\n/**\n * FUNCIÃ“N HELPER: Log de eventos de seguridad\n */ function logSecurityEvent(event, context) {\n    const logData = {\n        timestamp: new Date().toISOString(),\n        event,\n        userId: context.userId,\n        username: context.username,\n        role: context.role,\n        ip: context.ip || 'unknown',\n        userAgent: context.userAgent || 'unknown',\n        requestId: Math.random().toString(36).substring(7)\n    };\n    // En producciÃ³n, enviar a servicio de logging\n    console.log('[SECURITY]', JSON.stringify(logData));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TztRQUNkSCxRQUFRQyxJQUFJLENBQUMseUNBQXlDRTtRQUN0RCxPQUFPO0lBQ1Q7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU2dDLFlBQVk1QixJQUFZO0lBQ3RDLE1BQU02QixhQUFhO1FBQUM7UUFBUTtRQUFjO1FBQVM7S0FBYztJQUNqRSxPQUFPQSxXQUFXakIsUUFBUSxDQUFDWixNQUFNRztBQUNuQztBQUVBOztDQUVDLEdBQ00sU0FBUzJCLGlCQUFpQkMsS0FBYSxFQUFFQyxLQUFhO0lBQzNELE1BQU1DLGFBQXFDO1FBQ3pDLFFBQVE7UUFDUixjQUFjO1FBQ2QsU0FBUztRQUNULGVBQWU7SUFDakI7SUFFQSxNQUFNQyxTQUFTRCxVQUFVLENBQUNGLE9BQU81QixjQUFjLElBQUk7SUFDbkQsTUFBTWdDLFNBQVNGLFVBQVUsQ0FBQ0QsT0FBTzdCLGNBQWMsSUFBSTtJQUVuRCxPQUFPK0IsU0FBU0M7QUFDbEI7QUFFQTs7Q0FFQyxHQUNNLFNBQVNDLGlCQUNkQyxLQUFhLEVBQ2JwQyxPQUFtRTtJQUVuRSxNQUFNcUMsVUFBVTtRQUNkbkIsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO1FBQ2pDZ0I7UUFDQXZDLFFBQVFHLFFBQVFILE1BQU07UUFDdEJDLFVBQVVFLFFBQVFGLFFBQVE7UUFDMUJDLE1BQU1DLFFBQVFELElBQUk7UUFDbEJ1QyxJQUFJdEMsUUFBUXNDLEVBQUUsSUFBSTtRQUNsQkMsV0FBV3ZDLFFBQVF1QyxTQUFTLElBQUk7UUFDaENDLFdBQVdDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLFNBQVMsQ0FBQztJQUNsRDtJQUVBLDhDQUE4QztJQUM5Q3BELFFBQVFxRCxHQUFHLENBQUMsY0FBY0MsS0FBS0MsU0FBUyxDQUFDVjtBQUMzQyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBdXhTaXN0ZW1hc1xcRG9jdW1lbnRzXFxzaXN0ZW1hc1xcc2lzdFxcc2lzdGVtYVxcbGliXFxtaWRkbGV3YXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyB2ZXJpZnlKd3RXaXRoRXJyb3IgfSBmcm9tICdAL2xpYi9hdXRoJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBjb250ZXh0byBkZSBhdXRlbnRpY2FjacOzbiBtZWpvcmFkbyBjb24gc2lzdGVtYSBEaXNjb3JkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aENvbnRleHQge1xuICB1c2VySWQ6IG51bWJlcjtcbiAgdXNlcm5hbWU6IHN0cmluZztcbiAgcm9sZTogc3RyaW5nOyAvLyBNYW50ZW5lciBwYXJhIGNvbXBhdGliaWxpZGFkIGxlZ2FjeVxuICB0b2tlbj86IHN0cmluZztcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZXh0ZW5kaWRhIHBhcmEgY29udGV4dG8gY29uIHBlcm1pc29zIERpc2NvcmRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBEaXNjb3JkQXV0aENvbnRleHQgZXh0ZW5kcyBBdXRoQ29udGV4dCB7XG4gIGRpc2NvcmRSb2xlcz86IEFycmF5PHtcbiAgICBpZDogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nO1xuICAgIGxldmVsOiBudW1iZXI7XG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgaWNvbj86IHN0cmluZztcbiAgfT47XG4gIHBlcm1pc3Npb25zPzogc3RyaW5nW107XG4gIGhpZ2hlc3RSb2xlTGV2ZWw/OiBudW1iZXI7XG59XG5cbi8qKlxuICogQ2xhc2UgcGFyYSBlcnJvcmVzIGRlIGF1dGVudGljYWNpw7NuXG4gKi9cbmV4cG9ydCBjbGFzcyBBdXRoRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBwdWJsaWMgY29kZTogc3RyaW5nLFxuICAgIHB1YmxpYyBzdGF0dXM6IG51bWJlciA9IDQwMVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnQXV0aEVycm9yJztcbiAgfVxufVxuXG4vKipcbiAqIEZVTkNJw5NOIFBSSU5DSVBBTDogcmVxdWlyZUF1dGggLSBFeHRyYWVyIHkgdmVyaWZpY2FyIGF1dGVudGljYWNpw7NuXG4gKiBDb3JyaWdlIHByb2JsZW1hcyBkZSBcIkNhbm5vdCByZWFkIHByb3BlcnRpZXMgb2YgdW5kZWZpbmVkXCJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVBdXRoKHJlcTogTmV4dFJlcXVlc3QpOiBBdXRoQ29udGV4dCB7XG4gIHRyeSB7XG4gICAgLy8gQ09SUkVDQ0nDk046IEV4dHJhZXIgdG9rZW4gZGUgZm9ybWEgc2VndXJhXG4gICAgbGV0IHRva2VuOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gMS4gSW50ZW50YXIgZGVzZGUgY29va2llcyAobcOhcyBzZWd1cm8pXG4gICAgICBjb25zdCBjb29raWVUb2tlbiA9IHJlcS5jb29raWVzPy5nZXQoJ2F1dGhfdG9rZW4nKT8udmFsdWU7XG4gICAgICBpZiAoY29va2llVG9rZW4gJiYgdHlwZW9mIGNvb2tpZVRva2VuID09PSAnc3RyaW5nJykge1xuICAgICAgICB0b2tlbiA9IGNvb2tpZVRva2VuLnRyaW0oKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gMi4gU2kgbm8gaGF5IGNvb2tpZSwgaW50ZW50YXIgZGVzZGUgQXV0aG9yaXphdGlvbiBoZWFkZXIgKHBhcmEgQVBJcylcbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzPy5nZXQoJ0F1dGhvcml6YXRpb24nKTtcbiAgICAgICAgaWYgKGF1dGhIZWFkZXIgJiYgdHlwZW9mIGF1dGhIZWFkZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgY29uc3QgaGVhZGVyVG9rZW4gPSBhdXRoSGVhZGVyLnJlcGxhY2UoL15CZWFyZXJcXHMrL2ksICcnKS50cmltKCk7XG4gICAgICAgICAgaWYgKGhlYWRlclRva2VuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRva2VuID0gaGVhZGVyVG9rZW47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAodG9rZW5FcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBleHRyYXllbmRvIHRva2VuOicsIHRva2VuRXJyb3IpO1xuICAgICAgdG9rZW4gPSBudWxsO1xuICAgIH1cblxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBBdXRoRXJyb3IoJ1Rva2VuIGRlIGF1dGVudGljYWNpw7NuIHJlcXVlcmlkbycsICdUT0tFTl9SRVFVSVJFRCcsIDQwMSk7XG4gICAgfVxuXG4gICAgLy8gQ09SUkVDQ0nDk046IFZlcmlmaWNhciB0b2tlbiBKV1QgY29uIG1hbmVqbyByb2J1c3RvIGRlIGVycm9yZXNcbiAgICBjb25zdCB7IHBheWxvYWQsIGVycm9yLCBlcnJvckNvZGUgfSA9IHZlcmlmeUp3dFdpdGhFcnJvcjx7XG4gICAgICB1c2VySWQ6IG51bWJlcjtcbiAgICAgIHVzZXJuYW1lOiBzdHJpbmc7XG4gICAgICByb2xlOiBzdHJpbmc7XG4gICAgICBpYXQ/OiBudW1iZXI7XG4gICAgICBleHA/OiBudW1iZXI7XG4gICAgfT4odG9rZW4pO1xuXG4gICAgaWYgKGVycm9yIHx8ICFwYXlsb2FkKSB7XG4gICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKFxuICAgICAgICBlcnJvciB8fCAnVG9rZW4gaW52w6FsaWRvJywgXG4gICAgICAgIGVycm9yQ29kZSB8fCAnSU5WQUxJRF9UT0tFTicsIFxuICAgICAgICA0MDFcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gQ09SUkVDQ0nDk046IFZhbGlkYXIgZXN0cnVjdHVyYSBkZWwgcGF5bG9hZCBwYXJhIGV2aXRhciB1bmRlZmluZWRcbiAgICBpZiAoIXBheWxvYWQudXNlcklkIHx8IHR5cGVvZiBwYXlsb2FkLnVzZXJJZCAhPT0gJ251bWJlcicpIHtcbiAgICAgIHRocm93IG5ldyBBdXRoRXJyb3IoJ0lEIGRlIHVzdWFyaW8gaW52w6FsaWRvIGVuIHRva2VuJywgJ0lOVkFMSURfVVNFUl9JRCcsIDQwMSk7XG4gICAgfVxuXG4gICAgaWYgKCFwYXlsb2FkLnVzZXJuYW1lIHx8IHR5cGVvZiBwYXlsb2FkLnVzZXJuYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IEF1dGhFcnJvcignTm9tYnJlIGRlIHVzdWFyaW8gaW52w6FsaWRvIGVuIHRva2VuJywgJ0lOVkFMSURfVVNFUk5BTUUnLCA0MDEpO1xuICAgIH1cblxuICAgIGlmICghcGF5bG9hZC5yb2xlIHx8IHR5cGVvZiBwYXlsb2FkLnJvbGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKCdSb2wgZGUgdXN1YXJpbyBpbnbDoWxpZG8gZW4gdG9rZW4nLCAnSU5WQUxJRF9ST0xFJywgNDAxKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhciBjb250ZXh0byBkZSBhdXRlbnRpY2FjacOzbiB2w6FsaWRvXG4gICAgY29uc3QgY29udGV4dDogQXV0aENvbnRleHQgPSB7XG4gICAgICB1c2VySWQ6IHBheWxvYWQudXNlcklkLFxuICAgICAgdXNlcm5hbWU6IHBheWxvYWQudXNlcm5hbWUudG9Mb3dlckNhc2UoKS50cmltKCksXG4gICAgICByb2xlOiBwYXlsb2FkLnJvbGUudG9VcHBlckNhc2UoKS50cmltKCksXG4gICAgICB0b2tlbjogdG9rZW4sXG4gICAgfTtcblxuICAgIHJldHVybiBjb250ZXh0O1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXV0aEVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5lc3BlcmFkbyBlbiByZXF1aXJlQXV0aDonLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEF1dGhFcnJvcignRXJyb3IgZGUgYXV0ZW50aWNhY2nDs24nLCAnQVVUSF9FUlJPUicsIDQwMSk7XG4gIH1cbn1cblxuLyoqXG4gKiBGVU5DScOTTjogcmVxdWlyZVJvbGUgLSBWZXJpZmljYXIgcm9sZXMgZXNwZWPDrWZpY29zXG4gKiBDb3JyaWdlIHByb2JsZW1hcyBjb24gdmVyaWZpY2FjacOzbiBkZSByb2xlcyB1bmRlZmluZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVSb2xlKGNvbnRleHQ6IEF1dGhDb250ZXh0LCBhbGxvd2VkUm9sZXM6IHN0cmluZ1tdKTogdm9pZCB7XG4gIHRyeSB7XG4gICAgLy8gQ09SUkVDQ0nDk046IFZhbGlkYXIgY29udGV4dG8gZGUgZW50cmFkYVxuICAgIGlmICghY29udGV4dCB8fCB0eXBlb2YgY29udGV4dCAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHRocm93IG5ldyBBdXRoRXJyb3IoJ0NvbnRleHRvIGRlIGF1dGVudGljYWNpw7NuIGludsOhbGlkbycsICdJTlZBTElEX0NPTlRFWFQnLCA0MDEpO1xuICAgIH1cblxuICAgIGlmICghY29udGV4dC5yb2xlIHx8IHR5cGVvZiBjb250ZXh0LnJvbGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKCdSb2wgbm8gdsOhbGlkbyBlbiBjb250ZXh0bycsICdJTlZBTElEX1JPTEUnLCA0MDEpO1xuICAgIH1cblxuICAgIC8vIENPUlJFQ0NJw5NOOiBWYWxpZGFyIHJvbGVzIHBlcm1pdGlkb3NcbiAgICBpZiAoIWFsbG93ZWRSb2xlcyB8fCAhQXJyYXkuaXNBcnJheShhbGxvd2VkUm9sZXMpIHx8IGFsbG93ZWRSb2xlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBBdXRoRXJyb3IoJ1JvbGVzIHBlcm1pdGlkb3Mgbm8gZXNwZWNpZmljYWRvcycsICdOT19ST0xFU19TUEVDSUZJRUQnLCA1MDApO1xuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6YXIgcm9sZXMgcGFyYSBjb21wYXJhY2nDs24gY2FzZS1pbnNlbnNpdGl2ZVxuICAgIGNvbnN0IHVzZXJSb2xlID0gY29udGV4dC5yb2xlLnRvVXBwZXJDYXNlKCkudHJpbSgpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRBbGxvd2VkUm9sZXMgPSBhbGxvd2VkUm9sZXNcbiAgICAgIC5maWx0ZXIocm9sZSA9PiByb2xlICYmIHR5cGVvZiByb2xlID09PSAnc3RyaW5nJylcbiAgICAgIC5tYXAocm9sZSA9PiByb2xlLnRvVXBwZXJDYXNlKCkudHJpbSgpKTtcblxuICAgIGlmIChub3JtYWxpemVkQWxsb3dlZFJvbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEF1dGhFcnJvcignTm8gaGF5IHJvbGVzIHbDoWxpZG9zIGVzcGVjaWZpY2Fkb3MnLCAnTk9fVkFMSURfUk9MRVMnLCA1MDApO1xuICAgIH1cblxuICAgIC8vIENPUlJFQ0NJw5NOOiBWZXJpZmljYXIgc2kgZWwgdXN1YXJpbyB0aWVuZSB1bm8gZGUgbG9zIHJvbGVzIHBlcm1pdGlkb3NcbiAgICBpZiAoIW5vcm1hbGl6ZWRBbGxvd2VkUm9sZXMuaW5jbHVkZXModXNlclJvbGUpKSB7XG4gICAgICB0aHJvdyBuZXcgQXV0aEVycm9yKFxuICAgICAgICBgUGVybWlzb3MgaW5zdWZpY2llbnRlcy4gU2UgcmVxdWllcmU6ICR7YWxsb3dlZFJvbGVzLmpvaW4oJywgJyl9LiBBY3R1YWw6ICR7Y29udGV4dC5yb2xlfWAsXG4gICAgICAgICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICA0MDNcbiAgICAgICk7XG4gICAgfVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXV0aEVycm9yKSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW5lc3BlcmFkbyBlbiByZXF1aXJlUm9sZTonLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEF1dGhFcnJvcignRXJyb3IgZGUgdmVyaWZpY2FjacOzbiBkZSByb2xlcycsICdST0xFX0VSUk9SJywgNTAwKTtcbiAgfVxufVxuXG4vKipcbiAqIEZVTkNJw5NOOiByZXF1aXJlQWRtaW4gLSBWZXJpZmljYXIgcGVybWlzb3MgZGUgYWRtaW5pc3RyYWRvclxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZUFkbWluKGNvbnRleHQ6IEF1dGhDb250ZXh0KTogdm9pZCB7XG4gIHJlcXVpcmVSb2xlKGNvbnRleHQsIFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSk7XG59XG5cbi8qKlxuICogRlVOQ0nDk046IHJlcXVpcmVUZWNobmljaWFuIC0gVmVyaWZpY2FyIHBlcm1pc29zIHTDqWNuaWNvcyBvIHN1cGVyaW9yZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVUZWNobmljaWFuKGNvbnRleHQ6IEF1dGhDb250ZXh0KTogdm9pZCB7XG4gIHJlcXVpcmVSb2xlKGNvbnRleHQsIFsnVEVDSE5JQ0lBTicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddKTtcbn1cblxuLyoqXG4gKiBNSURETEVXQVJFIFdSQVBQRVI6IENvbnZlcnRpciByZXF1aXJlQXV0aCBhIG1pZGRsZXdhcmUgZGUgTmV4dEpTXG4gKiBQYXJhIHVzbyBlbiBydXRhcyBBUElcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBdXRoKGhhbmRsZXI6IChyZXE6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiBBdXRoQ29udGV4dCkgPT4gUHJvbWlzZTxOZXh0UmVzcG9uc2U+KSB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0UmVxdWVzdCk6IFByb21pc2U8TmV4dFJlc3BvbnNlPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSByZXF1aXJlQXV0aChyZXEpO1xuICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIocmVxLCBjb250ZXh0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXV0aEVycm9yKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IFxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsIFxuICAgICAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogZXJyb3Iuc3RhdHVzIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZW4gd2l0aEF1dGg6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRXJyb3IgZGUgYXV0ZW50aWNhY2nDs24gaW50ZXJubycsIGNvZGU6ICdJTlRFUk5BTF9BVVRIX0VSUk9SJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuICB9O1xufVxuXG4vKipcbiAqIE1JRERMRVdBUkUgV1JBUFBFUjogQ29tYmluYXIgYXV0aCArIHJvbGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQXV0aEFuZFJvbGUoXG4gIGFsbG93ZWRSb2xlczogc3RyaW5nW10sXG4gIGhhbmRsZXI6IChyZXE6IE5leHRSZXF1ZXN0LCBjb250ZXh0OiBBdXRoQ29udGV4dCkgPT4gUHJvbWlzZTxOZXh0UmVzcG9uc2U+XG4pIHtcbiAgcmV0dXJuIHdpdGhBdXRoKGFzeW5jIChyZXEsIGNvbnRleHQpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmVxdWlyZVJvbGUoY29udGV4dCwgYWxsb3dlZFJvbGVzKTtcbiAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVyKHJlcSwgY29udGV4dCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEF1dGhFcnJvcikge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBcbiAgICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLCBcbiAgICAgICAgICAgIGNvZGU6IGVycm9yLmNvZGUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IGVycm9yLnN0YXR1cyB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGVuIHdpdGhBdXRoQW5kUm9sZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdFcnJvciBkZSBhdXRvcml6YWNpw7NuIGludGVybm8nLCBjb2RlOiAnSU5URVJOQUxfUk9MRV9FUlJPUicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogRlVOQ0nDk046IHJlcXVpcmVQZXJtaXNzaW9uIC0gU2lzdGVtYSBkZSBwZXJtaXNvcyBncmFudWxhcmVzIHBhcmEgcHJvZHVjY2nDs25cbiAqIE1hcGVhIHBlcm1pc29zIGRlbCBudWV2byBzaXN0ZW1hIERpc2NvcmQgYSByb2xlcyBsZWdhY3kgcGFyYSBjb21wYXRpYmlsaWRhZFxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZVBlcm1pc3Npb24oY29udGV4dDogQXV0aENvbnRleHQsIHBlcm1pc3Npb246IHN0cmluZyk6IHZvaWQge1xuICAvLyBNYXBlbyBkZSBwZXJtaXNvcyBEaXNjb3JkIGEgcm9sZXMgbGVnYWN5IHBhcmEgY29tcGF0aWJpbGlkYWRcbiAgY29uc3QgcGVybWlzc2lvblRvUm9sZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAvLyBEYXNoYm9hcmQgcGVybWlzc2lvbnNcbiAgICAnZGFzaGJvYXJkOnZpZXcnOiBbJ1VTRVInLCAnRU1QTE9ZRUUnLCAnU1VQUE9SVCcsICdURUNITklDSUFOJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnZGFzaGJvYXJkOmV4cG9ydCc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBFcXVpcG1lbnQgcGVybWlzc2lvbnNcbiAgICAnZXF1aXBtZW50OnZpZXcnOiBbJ1VTRVInLCAnRU1QTE9ZRUUnLCAnU1VQUE9SVCcsICdURUNITklDSUFOJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnZXF1aXBtZW50OmNyZWF0ZSc6IFsnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdlcXVpcG1lbnQ6ZWRpdCc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ2VxdWlwbWVudDpkZWxldGUnOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ2VxdWlwbWVudDpleHBvcnQnOiBbJ1RFQ0hOSUNJQU4nLCAnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuXG4gICAgLy8gVGlja2V0cyBwZXJtaXNzaW9uc1xuICAgICd0aWNrZXRzOnZpZXdfb3duJzogWydVU0VSJywgJ0VNUExPWUVFJywgJ1NVUFBPUlQnLCAnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3RpY2tldHM6dmlld19hbGwnOiBbJ1NVUFBPUlQnLCAnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3RpY2tldHM6Y3JlYXRlJzogWydVU0VSJywgJ0VNUExPWUVFJywgJ1NVUFBPUlQnLCAnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3RpY2tldHM6ZWRpdF9vd24nOiBbJ1VTRVInLCAnRU1QTE9ZRUUnLCAnU1VQUE9SVCcsICdURUNITklDSUFOJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAndGlja2V0czplZGl0X2FsbCc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3RpY2tldHM6ZGVsZXRlJzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICd0aWNrZXRzOmFzc2lnbic6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3RpY2tldHM6Y2xvc2UnOiBbJ1RFQ0hOSUNJQU4nLCAnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuXG4gICAgLy8gRW1wbG95ZWVzIHBlcm1pc3Npb25zXG4gICAgJ2VtcGxveWVlczp2aWV3JzogWydTVVBQT1JUJywgJ1RFQ0hOSUNJQU4nLCAnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdlbXBsb3llZXM6Y3JlYXRlJzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdlbXBsb3llZXM6ZWRpdCc6IFsnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdlbXBsb3llZXM6ZGVsZXRlJzogWydTVVBFUl9BRE1JTiddLFxuICAgICdlbXBsb3llZXM6ZXhwb3J0JzogWydNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBJbnZlbnRvcnkgcGVybWlzc2lvbnNcbiAgICAnaW52ZW50b3J5OnZpZXcnOiBbJ1VTRVInLCAnRU1QTE9ZRUUnLCAnU1VQUE9SVCcsICdURUNITklDSUFOJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnaW52ZW50b3J5OmNyZWF0ZSc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ2ludmVudG9yeTplZGl0JzogWydURUNITklDSUFOJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnaW52ZW50b3J5OmRlbGV0ZSc6IFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnaW52ZW50b3J5OmFzc2lnbic6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBQcmludGVycyBwZXJtaXNzaW9uc1xuICAgICdwcmludGVyczp2aWV3JzogWydVU0VSJywgJ0VNUExPWUVFJywgJ1NVUFBPUlQnLCAnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3ByaW50ZXJzOmNyZWF0ZSc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3ByaW50ZXJzOmVkaXQnOiBbJ1RFQ0hOSUNJQU4nLCAnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdwcmludGVyczpkZWxldGUnOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3ByaW50ZXJzOm1hbmFnZV9jb25zdW1hYmxlcyc6IFsnVEVDSE5JQ0lBTicsICdNQU5BR0VSJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBQdXJjaGFzZXMgcGVybWlzc2lvbnNcbiAgICAncHVyY2hhc2VzOnZpZXcnOiBbJ1VTRVInLCAnRU1QTE9ZRUUnLCAnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdwdXJjaGFzZXM6Y3JlYXRlJzogWydVU0VSJywgJ0VNUExPWUVFJywgJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAncHVyY2hhc2VzOmFwcHJvdmUnOiBbJ01BTkFHRVInLCAnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAncHVyY2hhc2VzOnJlamVjdCc6IFsnTUFOQUdFUicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdwdXJjaGFzZXM6cHJvY2Vzcyc6IFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcblxuICAgIC8vIEJhY2t1cHMgcGVybWlzc2lvbnNcbiAgICAnYmFja3Vwczp2aWV3JzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdiYWNrdXBzOmNyZWF0ZSc6IFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAnYmFja3VwczpyZXN0b3JlJzogWydTVVBFUl9BRE1JTiddLFxuICAgICdiYWNrdXBzOmRlbGV0ZSc6IFsnU1VQRVJfQURNSU4nXSxcblxuICAgIC8vIFVzZXJzICYgUm9sZXMgcGVybWlzc2lvbnNcbiAgICAndXNlcnM6dmlldyc6IFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAndXNlcnM6Y3JlYXRlJzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICd1c2VyczplZGl0JzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICd1c2VyczpkZWxldGUnOiBbJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3VzZXJzOnJlc2V0X3Bhc3N3b3JkJzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuXG4gICAgJ3JvbGVzOnZpZXcnOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ3JvbGVzOmNyZWF0ZSc6IFsnU1VQRVJfQURNSU4nXSxcbiAgICAncm9sZXM6ZWRpdCc6IFsnU1VQRVJfQURNSU4nXSxcbiAgICAncm9sZXM6ZGVsZXRlJzogWydTVVBFUl9BRE1JTiddLFxuICAgICdyb2xlczphc3NpZ24nOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBTeXN0ZW0gcGVybWlzc2lvbnNcbiAgICAnc3lzdGVtOmNvbmZpZ3VyZSc6IFsnU1VQRVJfQURNSU4nXSxcbiAgICAnc3lzdGVtOmFkbWluJzogWydTVVBFUl9BRE1JTiddLFxuICAgICdhdWRpdDp2aWV3JzogWydBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICAgICdhdWRpdDpleHBvcnQnOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBXaWxkY2FyZCBwZXJtaXNzaW9uc1xuICAgICcqOionOiBbJ1NVUEVSX0FETUlOJ10sXG5cbiAgICAvLyBMZWdhY3kgcGVybWlzc2lvbnMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAndXNlcnM6cmVhZCc6IFsnQURNSU4nLCAnU1VQRVJfQURNSU4nXSxcbiAgICAndXNlcnM6d3JpdGUnOiBbJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ2VxdWlwbWVudDpyZWFkJzogWydURUNITklDSUFOJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ10sXG4gICAgJ2VxdWlwbWVudDp3cml0ZSc6IFsnVEVDSE5JQ0lBTicsICdBRE1JTicsICdTVVBFUl9BRE1JTiddLFxuICB9O1xuXG4gIGNvbnN0IHJlcXVpcmVkUm9sZXMgPSBwZXJtaXNzaW9uVG9Sb2xlc1twZXJtaXNzaW9uXTtcbiAgaWYgKCFyZXF1aXJlZFJvbGVzKSB7XG4gICAgLy8gU2kgbm8gZW5jdWVudHJhIGVsIHBlcm1pc28gZXNwZWPDrWZpY28sIHJlY2hhemFyIGFjY2VzbyBwb3Igc2VndXJpZGFkXG4gICAgdGhyb3cgbmV3IEF1dGhFcnJvcihgUGVybWlzbyBubyBhdXRvcml6YWRvOiAke3Blcm1pc3Npb259YCwgJ1BFUk1JU1NJT05fREVOSUVEJywgNDAzKTtcbiAgfVxuXG4gIHJlcXVpcmVSb2xlKGNvbnRleHQsIHJlcXVpcmVkUm9sZXMpO1xufVxuXG4vKipcbiAqIEZVTkNJw5NOIEhFTFBFUjogT2J0ZW5lciBpbmZvcm1hY2nDs24gZGVsIHVzdWFyaW8gZGVzZGUgdG9rZW5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJGcm9tVG9rZW4odG9rZW46IHN0cmluZyk6IEF1dGhDb250ZXh0IHwgbnVsbCB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwYXlsb2FkIH0gPSB2ZXJpZnlKd3RXaXRoRXJyb3I8e1xuICAgICAgdXNlcklkOiBudW1iZXI7XG4gICAgICB1c2VybmFtZTogc3RyaW5nO1xuICAgICAgcm9sZTogc3RyaW5nO1xuICAgIH0+KHRva2VuKTtcblxuICAgIGlmICghcGF5bG9hZCkgcmV0dXJuIG51bGw7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcklkOiBwYXlsb2FkLnVzZXJJZCxcbiAgICAgIHVzZXJuYW1lOiBwYXlsb2FkLnVzZXJuYW1lLFxuICAgICAgcm9sZTogcGF5bG9hZC5yb2xlLFxuICAgICAgdG9rZW5cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignRXJyb3Igb2J0ZW5pZW5kbyB1c3VhcmlvIGRlc2RlIHRva2VuOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEZVTkNJw5NOIEhFTFBFUjogVmVyaWZpY2FyIHNpIHVuIHJvbCBlcyB2w6FsaWRvXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkUm9sZShyb2xlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgdmFsaWRSb2xlcyA9IFsnVVNFUicsICdURUNITklDSUFOJywgJ0FETUlOJywgJ1NVUEVSX0FETUlOJ107XG4gIHJldHVybiB2YWxpZFJvbGVzLmluY2x1ZGVzKHJvbGU/LnRvVXBwZXJDYXNlKCkpO1xufVxuXG4vKipcbiAqIEZVTkNJw5NOIEhFTFBFUjogQ29tcGFyYXIgbml2ZWxlcyBkZSByb2xlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZVJvbGVMZXZlbChyb2xlMTogc3RyaW5nLCByb2xlMjogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3Qgcm9sZUxldmVsczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgICAnVVNFUic6IDEwLFxuICAgICdURUNITklDSUFOJzogMjAsXG4gICAgJ0FETUlOJzogMzAsXG4gICAgJ1NVUEVSX0FETUlOJzogNDAsXG4gIH07XG5cbiAgY29uc3QgbGV2ZWwxID0gcm9sZUxldmVsc1tyb2xlMT8udG9VcHBlckNhc2UoKV0gfHwgMDtcbiAgY29uc3QgbGV2ZWwyID0gcm9sZUxldmVsc1tyb2xlMj8udG9VcHBlckNhc2UoKV0gfHwgMDtcblxuICByZXR1cm4gbGV2ZWwxIC0gbGV2ZWwyO1xufVxuXG4vKipcbiAqIEZVTkNJw5NOIEhFTFBFUjogTG9nIGRlIGV2ZW50b3MgZGUgc2VndXJpZGFkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2dTZWN1cml0eUV2ZW50KFxuICBldmVudDogc3RyaW5nLFxuICBjb250ZXh0OiBQYXJ0aWFsPEF1dGhDb250ZXh0PiAmIHsgaXA/OiBzdHJpbmc7IHVzZXJBZ2VudD86IHN0cmluZyB9XG4pOiB2b2lkIHtcbiAgY29uc3QgbG9nRGF0YSA9IHtcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICBldmVudCxcbiAgICB1c2VySWQ6IGNvbnRleHQudXNlcklkLFxuICAgIHVzZXJuYW1lOiBjb250ZXh0LnVzZXJuYW1lLFxuICAgIHJvbGU6IGNvbnRleHQucm9sZSxcbiAgICBpcDogY29udGV4dC5pcCB8fCAndW5rbm93bicsXG4gICAgdXNlckFnZW50OiBjb250ZXh0LnVzZXJBZ2VudCB8fCAndW5rbm93bicsXG4gICAgcmVxdWVzdElkOiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyksXG4gIH07XG5cbiAgLy8gRW4gcHJvZHVjY2nDs24sIGVudmlhciBhIHNlcnZpY2lvIGRlIGxvZ2dpbmdcbiAgY29uc29sZS5sb2coJ1tTRUNVUklUWV0nLCBKU09OLnN0cmluZ2lmeShsb2dEYXRhKSk7XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInZlcmlmeUp3dFdpdGhFcnJvciIsIkF1dGhFcnJvciIsIkVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwiY29kZSIsInN0YXR1cyIsIm5hbWUiLCJyZXF1aXJlQXV0aCIsInJlcSIsInRva2VuIiwiY29va2llVG9rZW4iLCJjb29raWVzIiwiZ2V0IiwidmFsdWUiLCJ0cmltIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJoZWFkZXJUb2tlbiIsInJlcGxhY2UiLCJsZW5ndGgiLCJ0b2tlbkVycm9yIiwiY29uc29sZSIsIndhcm4iLCJwYXlsb2FkIiwiZXJyb3IiLCJlcnJvckNvZGUiLCJ1c2VySWQiLCJ1c2VybmFtZSIsInJvbGUiLCJjb250ZXh0IiwidG9Mb3dlckNhc2UiLCJ0b1VwcGVyQ2FzZSIsInJlcXVpcmVSb2xlIiwiYWxsb3dlZFJvbGVzIiwiQXJyYXkiLCJpc0FycmF5IiwidXNlclJvbGUiLCJub3JtYWxpemVkQWxsb3dlZFJvbGVzIiwiZmlsdGVyIiwibWFwIiwiaW5jbHVkZXMiLCJqb2luIiwicmVxdWlyZUFkbWluIiwicmVxdWlyZVRlY2huaWNpYW4iLCJ3aXRoQXV0aCIsImhhbmRsZXIiLCJqc29uIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwid2l0aEF1dGhBbmRSb2xlIiwicmVxdWlyZVBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwicGVybWlzc2lvblRvUm9sZXMiLCJyZXF1aXJlZFJvbGVzIiwiZ2V0VXNlckZyb21Ub2tlbiIsImlzVmFsaWRSb2xlIiwidmFsaWRSb2xlcyIsImNvbXBhcmVSb2xlTGV2ZWwiLCJyb2xlMSIsInJvbGUyIiwicm9sZUxldmVscyIsImxldmVsMSIsImxldmVsMiIsImxvZ1NlY3VyaXR5RXZlbnQiLCJldmVudCIsImxvZ0RhdGEiLCJpcCIsInVzZXJBZ2VudCIsInJlcXVlc3RJZCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/middleware.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   disconnectPrisma: () => (/* binding */ disconnectPrisma),\n/* harmony export */   getPrisma: () => (/* binding */ getPrisma),\n/* harmony export */   isDatabaseAvailable: () => (/* binding */ isDatabaseAvailable),\n/* harmony export */   prisma: () => (/* binding */ prisma),\n/* harmony export */   withDatabase: () => (/* binding */ withDatabase)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nlet prismaInstance = null;\nlet connectionError = null;\nlet isConnecting = false;\nconst prismaConfig = {\n    log:  true ? [\n        'error',\n        'warn'\n    ] : 0,\n    datasources: {\n        db: {\n            url: process.env.DATABASE_URL\n        }\n    }\n};\nasync function getPrisma() {\n    if (prismaInstance) {\n        try {\n            await prismaInstance.$queryRaw`SELECT 1 as test`;\n            return prismaInstance;\n        } catch (error) {\n            prismaInstance = null;\n            connectionError = null;\n        }\n    }\n    if (isConnecting) {\n        let attempts = 0;\n        while(isConnecting && attempts < 50){\n            await new Promise((resolve)=>setTimeout(resolve, 100));\n            attempts++;\n        }\n        if (prismaInstance) return prismaInstance;\n    }\n    if (connectionError) {\n        throw new Error(`Database connection failed: ${connectionError}`);\n    }\n    try {\n        isConnecting = true;\n        prismaInstance = global.prismaGlobal ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient(prismaConfig);\n        prismaInstance.$on('error', (e)=>{\n            console.error('Database error:', e);\n        });\n        const connectionTimeout = new Promise((_, reject)=>setTimeout(()=>reject(new Error('Database connection timeout')), 10000));\n        await Promise.race([\n            prismaInstance.$connect(),\n            connectionTimeout\n        ]);\n        await prismaInstance.$queryRaw`SELECT 1 as test`;\n        if (true) {\n            global.prismaGlobal = prismaInstance;\n        }\n        isConnecting = false;\n        return prismaInstance;\n    } catch (error) {\n        isConnecting = false;\n        connectionError = error instanceof Error ? error.message : 'Unknown database error';\n        if (prismaInstance) {\n            try {\n                await prismaInstance.$disconnect();\n            } catch (disconnectError) {\n            // Ignore disconnect errors\n            }\n            prismaInstance = null;\n        }\n        throw new Error(`Database connection failed: ${connectionError}`);\n    }\n}\nasync function isDatabaseAvailable() {\n    let testClient = null;\n    try {\n        testClient = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n            log: [],\n            datasources: {\n                db: {\n                    url: process.env.DATABASE_URL\n                }\n            }\n        });\n        const testTimeout = new Promise((_, reject)=>setTimeout(()=>reject(new Error('Database test timeout')), 8000));\n        await Promise.race([\n            testClient.$connect(),\n            testTimeout\n        ]);\n        await Promise.race([\n            testClient.$queryRaw`SELECT 1 as test`,\n            testTimeout\n        ]);\n        return true;\n    } catch (error) {\n        return false;\n    } finally{\n        if (testClient) {\n            try {\n                await testClient.$disconnect();\n            } catch (disconnectError) {\n            // Ignore\n            }\n        }\n    }\n}\nasync function withDatabase(operation, fallback, options) {\n    const { retries = 2, retryDelay = 1000, timeoutMs = 30000 } = options || {};\n    if (!operation || typeof operation !== 'function') {\n        throw new Error('Operation must be a function');\n    }\n    let lastError = null;\n    for(let attempt = 1; attempt <= retries + 1; attempt++){\n        try {\n            const prisma = await getPrisma();\n            const operationTimeout = new Promise((_, reject)=>setTimeout(()=>reject(new Error('Database operation timeout')), timeoutMs));\n            const result = await Promise.race([\n                operation(prisma),\n                operationTimeout\n            ]);\n            return result;\n        } catch (error) {\n            lastError = error instanceof Error ? error : new Error(String(error));\n            if (attempt > retries) {\n                break;\n            }\n            if (prismaInstance) {\n                try {\n                    await prismaInstance.$disconnect();\n                } catch (disconnectError) {\n                // Ignore\n                }\n                prismaInstance = null;\n                connectionError = null;\n            }\n            if (retryDelay > 0) {\n                await new Promise((resolve)=>setTimeout(resolve, retryDelay));\n            }\n        }\n    }\n    if (fallback) {\n        try {\n            return await fallback();\n        } catch (fallbackError) {\n            throw lastError || new Error('Database operation and fallback both failed');\n        }\n    }\n    throw lastError || new Error('Database operation failed');\n}\nasync function disconnectPrisma() {\n    if (prismaInstance) {\n        try {\n            await prismaInstance.$disconnect();\n        } catch (error) {\n        // Ignore\n        } finally{\n            prismaInstance = null;\n            connectionError = null;\n            if (true) {\n                global.prismaGlobal = undefined;\n            }\n        }\n    }\n}\nconst prisma = new Proxy({}, {\n    get (target, prop, receiver) {\n        if (prop === 'then' || prop === 'catch' || prop === 'finally') {\n            return undefined;\n        }\n        if (!prismaInstance) {\n            throw new Error('Database not initialized. Use getPrisma() or withDatabase() instead.');\n        }\n        const value = prismaInstance[prop];\n        if (typeof value === 'function') {\n            return function(...args) {\n                try {\n                    return value.apply(prismaInstance, args);\n                } catch (error) {\n                    throw error;\n                }\n            };\n        }\n        return value;\n    }\n});\nif (typeof process !== 'undefined') {\n    process.on('SIGTERM', disconnectPrisma);\n    process.on('SIGINT', disconnectPrisma);\n    process.on('beforeExit', disconnectPrisma);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNTixhQUFhLElBQUl4QixNQUFNO1FBQy9CO0lBQ0Y7SUFFQSxNQUFNd0IsYUFBYSxJQUFJeEIsTUFBTTtBQUMvQjtBQUVPLGVBQWUrQjtJQUNwQixJQUFJakQsZ0JBQWdCO1FBQ2xCLElBQUk7WUFDRixNQUFNQSxlQUFlOEIsV0FBVztRQUNsQyxFQUFFLE9BQU9qQixPQUFPO1FBQ2QsU0FBUztRQUNYLFNBQVU7WUFDUmIsaUJBQWlCO1lBQ2pCQyxrQkFBa0I7WUFFbEIsSUFBSUksSUFBcUMsRUFBRTtnQkFDekNjLE9BQU9DLFlBQVksR0FBRzhCO1lBQ3hCO1FBQ0Y7SUFDRjtBQUNGO0FBRU8sTUFBTU4sU0FBUyxJQUFJTyxNQUFNLENBQUMsR0FBbUI7SUFDbERDLEtBQUlDLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxRQUFRO1FBQ3hCLElBQUlELFNBQVMsVUFBVUEsU0FBUyxXQUFXQSxTQUFTLFdBQVc7WUFDN0QsT0FBT0o7UUFDVDtRQUVBLElBQUksQ0FBQ2xELGdCQUFnQjtZQUNuQixNQUFNLElBQUlrQixNQUNSO1FBRUo7UUFFQSxNQUFNc0MsUUFBUSxjQUF1QixDQUFDRixLQUFLO1FBRTNDLElBQUksT0FBT0UsVUFBVSxZQUFZO1lBQy9CLE9BQU8sU0FBb0IsR0FBR0MsSUFBVztnQkFDdkMsSUFBSTtvQkFDRixPQUFPRCxNQUFNRSxLQUFLLENBQUMxRCxnQkFBZ0J5RDtnQkFDckMsRUFBRSxPQUFPNUMsT0FBTztvQkFDZCxNQUFNQTtnQkFDUjtZQUNGO1FBQ0Y7UUFFQSxPQUFPMkM7SUFDVDtBQUNGLEdBQUc7QUFFSCxJQUFJLE9BQU9uRCxZQUFZLGFBQWE7SUFDbENBLFFBQVFzRCxFQUFFLENBQUMsV0FBV1Y7SUFDdEI1QyxRQUFRc0QsRUFBRSxDQUFDLFVBQVVWO0lBQ3JCNUMsUUFBUXNELEVBQUUsQ0FBQyxjQUFjVjtBQUMzQiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBdXhTaXN0ZW1hc1xcRG9jdW1lbnRzXFxzaXN0ZW1hc1xcc2lzdFxcc2lzdGVtYVxcbGliXFxwcmlzbWEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgdmFyIHByaXNtYUdsb2JhbDogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xufVxuXG5sZXQgcHJpc21hSW5zdGFuY2U6IFByaXNtYUNsaWVudCB8IG51bGwgPSBudWxsO1xubGV0IGNvbm5lY3Rpb25FcnJvcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5sZXQgaXNDb25uZWN0aW5nID0gZmFsc2U7XG5cbmNvbnN0IHByaXNtYUNvbmZpZyA9IHtcbiAgbG9nOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50J1xuICAgID8gWydlcnJvcicsICd3YXJuJ11cbiAgICA6IFsnZXJyb3InXSxcbiAgZGF0YXNvdXJjZXM6IHtcbiAgICBkYjoge1xuICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gICAgfSxcbiAgfSxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRQcmlzbWEoKTogUHJvbWlzZTxQcmlzbWFDbGllbnQ+IHtcbiAgaWYgKHByaXNtYUluc3RhbmNlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHByaXNtYUluc3RhbmNlLiRxdWVyeVJhd2BTRUxFQ1QgMSBhcyB0ZXN0YDtcbiAgICAgIHJldHVybiBwcmlzbWFJbnN0YW5jZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcHJpc21hSW5zdGFuY2UgPSBudWxsO1xuICAgICAgY29ubmVjdGlvbkVycm9yID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBpZiAoaXNDb25uZWN0aW5nKSB7XG4gICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICB3aGlsZSAoaXNDb25uZWN0aW5nICYmIGF0dGVtcHRzIDwgNTApIHtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgIGF0dGVtcHRzKys7XG4gICAgfVxuICAgIGlmIChwcmlzbWFJbnN0YW5jZSkgcmV0dXJuIHByaXNtYUluc3RhbmNlO1xuICB9XG5cbiAgaWYgKGNvbm5lY3Rpb25FcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQ6ICR7Y29ubmVjdGlvbkVycm9yfWApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBpc0Nvbm5lY3RpbmcgPSB0cnVlO1xuXG4gICAgcHJpc21hSW5zdGFuY2UgPSBnbG9iYWwucHJpc21hR2xvYmFsID8/IG5ldyBQcmlzbWFDbGllbnQocHJpc21hQ29uZmlnKTtcblxuICAgIHByaXNtYUluc3RhbmNlLiRvbignZXJyb3InLCAoZSkgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgZXJyb3I6JywgZSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBjb25uZWN0aW9uVGltZW91dCA9IG5ldyBQcm9taXNlPG5ldmVyPigoXywgcmVqZWN0KSA9PlxuICAgICAgc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIHRpbWVvdXQnKSksIDEwMDAwKVxuICAgICk7XG5cbiAgICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgcHJpc21hSW5zdGFuY2UuJGNvbm5lY3QoKSxcbiAgICAgIGNvbm5lY3Rpb25UaW1lb3V0XG4gICAgXSk7XG5cbiAgICBhd2FpdCBwcmlzbWFJbnN0YW5jZS4kcXVlcnlSYXdgU0VMRUNUIDEgYXMgdGVzdGA7XG4gICAgXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgICAgZ2xvYmFsLnByaXNtYUdsb2JhbCA9IHByaXNtYUluc3RhbmNlO1xuICAgIH1cblxuICAgIGlzQ29ubmVjdGluZyA9IGZhbHNlO1xuICAgIHJldHVybiBwcmlzbWFJbnN0YW5jZTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGlzQ29ubmVjdGluZyA9IGZhbHNlO1xuICAgIGNvbm5lY3Rpb25FcnJvciA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZGF0YWJhc2UgZXJyb3InO1xuICAgIFxuICAgIGlmIChwcmlzbWFJbnN0YW5jZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcHJpc21hSW5zdGFuY2UuJGRpc2Nvbm5lY3QoKTtcbiAgICAgIH0gY2F0Y2ggKGRpc2Nvbm5lY3RFcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgZGlzY29ubmVjdCBlcnJvcnNcbiAgICAgIH1cbiAgICAgIHByaXNtYUluc3RhbmNlID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgdGhyb3cgbmV3IEVycm9yKGBEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZDogJHtjb25uZWN0aW9uRXJyb3J9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzRGF0YWJhc2VBdmFpbGFibGUoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGxldCB0ZXN0Q2xpZW50OiBQcmlzbWFDbGllbnQgfCBudWxsID0gbnVsbDtcbiAgXG4gIHRyeSB7XG4gICAgdGVzdENsaWVudCA9IG5ldyBQcmlzbWFDbGllbnQoe1xuICAgICAgbG9nOiBbXSxcbiAgICAgIGRhdGFzb3VyY2VzOiB7XG4gICAgICAgIGRiOiB7XG4gICAgICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGVzdFRpbWVvdXQgPSBuZXcgUHJvbWlzZTxuZXZlcj4oKF8sIHJlamVjdCkgPT5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcignRGF0YWJhc2UgdGVzdCB0aW1lb3V0JykpLCA4MDAwKVxuICAgICk7XG5cbiAgICBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgdGVzdENsaWVudC4kY29ubmVjdCgpLFxuICAgICAgdGVzdFRpbWVvdXRcbiAgICBdKTtcblxuICAgIGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICB0ZXN0Q2xpZW50LiRxdWVyeVJhd2BTRUxFQ1QgMSBhcyB0ZXN0YCxcbiAgICAgIHRlc3RUaW1lb3V0XG4gICAgXSk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAodGVzdENsaWVudCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGVzdENsaWVudC4kZGlzY29ubmVjdCgpO1xuICAgICAgfSBjYXRjaCAoZGlzY29ubmVjdEVycm9yKSB7XG4gICAgICAgIC8vIElnbm9yZVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gd2l0aERhdGFiYXNlPFQ+KFxuICBvcGVyYXRpb246IChwcmlzbWE6IFByaXNtYUNsaWVudCkgPT4gUHJvbWlzZTxUPixcbiAgZmFsbGJhY2s/OiAoKSA9PiBQcm9taXNlPFQ+LFxuICBvcHRpb25zPzoge1xuICAgIHJldHJpZXM/OiBudW1iZXI7XG4gICAgcmV0cnlEZWxheT86IG51bWJlcjtcbiAgICB0aW1lb3V0TXM/OiBudW1iZXI7XG4gIH1cbik6IFByb21pc2U8VD4ge1xuICBjb25zdCB7XG4gICAgcmV0cmllcyA9IDIsXG4gICAgcmV0cnlEZWxheSA9IDEwMDAsXG4gICAgdGltZW91dE1zID0gMzAwMDBcbiAgfSA9IG9wdGlvbnMgfHwge307XG5cbiAgaWYgKCFvcGVyYXRpb24gfHwgdHlwZW9mIG9wZXJhdGlvbiAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcignT3BlcmF0aW9uIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuICB9XG5cbiAgbGV0IGxhc3RFcnJvcjogRXJyb3IgfCBudWxsID0gbnVsbDtcblxuICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSByZXRyaWVzICsgMTsgYXR0ZW1wdCsrKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHByaXNtYSA9IGF3YWl0IGdldFByaXNtYSgpO1xuICAgICAgXG4gICAgICBjb25zdCBvcGVyYXRpb25UaW1lb3V0ID0gbmV3IFByb21pc2U8bmV2ZXI+KChfLCByZWplY3QpID0+XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVqZWN0KG5ldyBFcnJvcignRGF0YWJhc2Ugb3BlcmF0aW9uIHRpbWVvdXQnKSksIHRpbWVvdXRNcylcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgIG9wZXJhdGlvbihwcmlzbWEpLFxuICAgICAgICBvcGVyYXRpb25UaW1lb3V0XG4gICAgICBdKTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsYXN0RXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoU3RyaW5nKGVycm9yKSk7XG4gICAgICBcbiAgICAgIGlmIChhdHRlbXB0ID4gcmV0cmllcykge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKHByaXNtYUluc3RhbmNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgcHJpc21hSW5zdGFuY2UuJGRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfSBjYXRjaCAoZGlzY29ubmVjdEVycm9yKSB7XG4gICAgICAgICAgLy8gSWdub3JlXG4gICAgICAgIH1cbiAgICAgICAgcHJpc21hSW5zdGFuY2UgPSBudWxsO1xuICAgICAgICBjb25uZWN0aW9uRXJyb3IgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAocmV0cnlEZWxheSA+IDApIHtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIHJldHJ5RGVsYXkpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoZmFsbGJhY2spIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGZhbGxiYWNrKCk7XG4gICAgfSBjYXRjaCAoZmFsbGJhY2tFcnJvcikge1xuICAgICAgdGhyb3cgbGFzdEVycm9yIHx8IG5ldyBFcnJvcignRGF0YWJhc2Ugb3BlcmF0aW9uIGFuZCBmYWxsYmFjayBib3RoIGZhaWxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIHRocm93IGxhc3RFcnJvciB8fCBuZXcgRXJyb3IoJ0RhdGFiYXNlIG9wZXJhdGlvbiBmYWlsZWQnKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpc2Nvbm5lY3RQcmlzbWEoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmIChwcmlzbWFJbnN0YW5jZSkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBwcmlzbWFJbnN0YW5jZS4kZGlzY29ubmVjdCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBJZ25vcmVcbiAgICB9IGZpbmFsbHkge1xuICAgICAgcHJpc21hSW5zdGFuY2UgPSBudWxsO1xuICAgICAgY29ubmVjdGlvbkVycm9yID0gbnVsbDtcbiAgICAgIFxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgICAgICBnbG9iYWwucHJpc21hR2xvYmFsID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcHJpc21hID0gbmV3IFByb3h5KHt9IGFzIFByaXNtYUNsaWVudCwge1xuICBnZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikge1xuICAgIGlmIChwcm9wID09PSAndGhlbicgfHwgcHJvcCA9PT0gJ2NhdGNoJyB8fCBwcm9wID09PSAnZmluYWxseScpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIFxuICAgIGlmICghcHJpc21hSW5zdGFuY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZC4gVXNlIGdldFByaXNtYSgpIG9yIHdpdGhEYXRhYmFzZSgpIGluc3RlYWQuJ1xuICAgICAgKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmFsdWUgPSAocHJpc21hSW5zdGFuY2UgYXMgYW55KVtwcm9wXTtcbiAgICBcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24odGhpczogYW55LCAuLi5hcmdzOiBhbnlbXSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZS5hcHBseShwcmlzbWFJbnN0YW5jZSwgYXJncyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufSk7XG5cbmlmICh0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgcHJvY2Vzcy5vbignU0lHVEVSTScsIGRpc2Nvbm5lY3RQcmlzbWEpO1xuICBwcm9jZXNzLm9uKCdTSUdJTlQnLCBkaXNjb25uZWN0UHJpc21hKTtcbiAgcHJvY2Vzcy5vbignYmVmb3JlRXhpdCcsIGRpc2Nvbm5lY3RQcmlzbWEpO1xufSJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJwcmlzbWFJbnN0YW5jZSIsImNvbm5lY3Rpb25FcnJvciIsImlzQ29ubmVjdGluZyIsInByaXNtYUNvbmZpZyIsImxvZyIsInByb2Nlc3MiLCJkYXRhc291cmNlcyIsImRiIiwidXJsIiwiZW52IiwiREFUQUJBU0VfVVJMIiwiZ2V0UHJpc21hIiwiJHF1ZXJ5UmF3IiwiZXJyb3IiLCJhdHRlbXB0cyIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsIkVycm9yIiwiZ2xvYmFsIiwicHJpc21hR2xvYmFsIiwiJG9uIiwiZSIsImNvbnNvbGUiLCJjb25uZWN0aW9uVGltZW91dCIsIl8iLCJyZWplY3QiLCJyYWNlIiwiJGNvbm5lY3QiLCJtZXNzYWdlIiwiJGRpc2Nvbm5lY3QiLCJkaXNjb25uZWN0RXJyb3IiLCJpc0RhdGFiYXNlQXZhaWxhYmxlIiwidGVzdENsaWVudCIsInRlc3RUaW1lb3V0Iiwid2l0aERhdGFiYXNlIiwib3BlcmF0aW9uIiwiZmFsbGJhY2siLCJvcHRpb25zIiwicmV0cmllcyIsInJldHJ5RGVsYXkiLCJ0aW1lb3V0TXMiLCJsYXN0RXJyb3IiLCJhdHRlbXB0IiwicHJpc21hIiwib3BlcmF0aW9uVGltZW91dCIsInJlc3VsdCIsIlN0cmluZyIsImZhbGxiYWNrRXJyb3IiLCJkaXNjb25uZWN0UHJpc21hIiwidW5kZWZpbmVkIiwiUHJveHkiLCJnZXQiLCJ0YXJnZXQiLCJwcm9wIiwicmVjZWl2ZXIiLCJ2YWx1ZSIsImFyZ3MiLCJhcHBseSIsIm9uIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_AuxSistemas_Documents_sistemas_sist_sistema_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/auth/me/route.ts */ \"(rsc)/./app/api/auth/me/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/me/route\",\n        pathname: \"/api/auth/me\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/me/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\AuxSistemas\\\\Documents\\\\sistemas\\\\sist\\\\sistema\\\\app\\\\api\\\\auth\\\\me\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_AuxSistemas_Documents_sistemas_sist_sistema_app_api_auth_me_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbWUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZtZSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNBdXhTaXN0ZW1hcyU1Q0RvY3VtZW50cyU1Q3Npc3RlbWFzJTVDc2lzdCU1Q3Npc3RlbWElNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q0F1eFNpc3RlbWFzJTVDRG9jdW1lbnRzJTVDc2lzdGVtYXMlNUNzaXN0JTVDc2lzdGVtYSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDd0M7QUFDckg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXEF1eFNpc3RlbWFzXFxcXERvY3VtZW50c1xcXFxzaXN0ZW1hc1xcXFxzaXN0XFxcXHNpc3RlbWFcXFxcYXBwXFxcXGFwaVxcXFxhdXRoXFxcXG1lXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoL21lL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aC9tZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYXV0aC9tZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXEF1eFNpc3RlbWFzXFxcXERvY3VtZW50c1xcXFxzaXN0ZW1hc1xcXFxzaXN0XFxcXHNpc3RlbWFcXFxcYXBwXFxcXGFwaVxcXFxhdXRoXFxcXG1lXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("bcrypt");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fme%2Froute&page=%2Fapi%2Fauth%2Fme%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fme%2Froute.ts&appDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5CAuxSistemas%5CDocuments%5Csistemas%5Csist%5Csistema&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();